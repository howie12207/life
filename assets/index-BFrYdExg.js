import{j as e,r as a,u as k,a as N,B as y,b as S}from"./index-BexVp5Hw.js";import{u as A}from"./diary-CeOEAkJm.js";import{f,a as j}from"./index-72uzsLfF.js";import{s as L,B as b}from"./index-DCr3VI-g.js";import{R as I,L as E,X as M,Y as C,T as W,a as B,b as m}from"./LineChart-Bki0RObp.js";import"./floating-ui.react-dom-PBNnPgws.js";import"./isEqual-C__mjSRy.js";const H=()=>e.jsx("section",{className:"mt-4",children:e.jsxs("ol",{children:[e.jsx("li",{children:"99~103 大學"}),e.jsx("li",{children:"103~104 替代役"}),e.jsx("li",{children:"104/10~108/10 微星科技"}),e.jsx("li",{children:"109/03 鼎羿科技"}),e.jsx("li",{children:"109/05~110/09 大牛科技"}),e.jsx("li",{children:"110/09~110/11 智雲資訊"}),e.jsx("li",{children:"110/11~ 富蘭克林"})]})}),w=new Date,D=({chartData:i})=>{const[c,g]=a.useState(L(w,6)),[o,x]=a.useState(w),p=(i==null?void 0:i.length)||0,[u,h]=a.useState({startIndex:0,endIndex:0});a.useEffect(()=>{const s=i==null?void 0:i.findIndex(l=>Number(l==null?void 0:l.diaryTime)>=new Date(c).valueOf()),t=i==null?void 0:i.findLastIndex(l=>Number(l==null?void 0:l.diaryTime)<=new Date(o).valueOf());h({startIndex:s,endIndex:t})},[i,h,p,c,o]);const d=a.useMemo(()=>i.slice(u.startIndex,u.endIndex+1),[u,i]),n=a.useMemo(()=>d.length?d.reduce((s,t)=>t.weight>s.weight?t:s):null,[d]),r=a.useMemo(()=>d.length?d.reduce((s,t)=>t.weight<s.weight?t:s):null,[d]);return e.jsxs("div",{style:{width:"100%",height:400},children:[e.jsxs("div",{className:"flex flex-col justify-end gap-2 p-2 sm:flex-row sm:items-center",children:[e.jsx(b,{label:"起始日",value:c,setValue:g,placeholder:"請選擇日期起始"}),e.jsx(b,{label:"結束日",value:o,setValue:x,placeholder:"請選擇日期結束"})]}),e.jsx(I,{children:e.jsxs(E,{data:d,margin:{top:20,right:10,left:10,bottom:5},children:[e.jsx(M,{dataKey:"diaryTime",tick:({x:s,y:t,payload:l})=>e.jsx("text",{x:s,y:t+15,textAnchor:"middle",fill:"#666",children:f(l.value,{onlyDate:!0})})}),e.jsx(C,{tick:({x:s,y:t,payload:l})=>e.jsx("text",{x:s,y:t,textAnchor:"end",fill:"#666",children:j(l.value)})}),e.jsx(W,{content:({active:s,payload:t,label:l})=>s&&t&&t.length?e.jsxs("div",{style:{backgroundColor:"#fff",border:"1px solid #ccc",padding:10},children:[e.jsxs("p",{className:"mb-2 flex justify-between gap-1 border-b-2 pb-1",children:[e.jsx("strong",{className:"font-bold",children:"時間"}),e.jsx("span",{children:`${f(l,{onlyDate:!0})}`})]}),t.map((T,v)=>e.jsxs("p",{className:"flex justify-between gap-1",children:[e.jsx("strong",{className:"font-bold",children:"體重"}),e.jsx("span",{children:j(T.value)})]},v))]}):null}),e.jsx(B,{name:"weight",type:"monotone",dataKey:"weight",stroke:"#8884d8",strokeWidth:2,dot:{r:1},activeDot:{r:4}}),e.jsx(m,{x:n==null?void 0:n.diaryTime,y:n==null?void 0:n.weight,r:5,fill:"red",label:({viewBox:s,offset:t})=>e.jsxs("text",{offset:t,x:s.x,y:s.y-30,fill:"red",textAnchor:"end",children:[e.jsx("tspan",{children:f(n==null?void 0:n.diaryTime,{onlyDate:!0})}),e.jsx("tspan",{x:s.x,dy:"20",children:`${j(n==null?void 0:n.weight,{suffix:"kg"})}`})]})}),e.jsx(m,{x:r==null?void 0:r.diaryTime,y:r==null?void 0:r.weight,r:5,fill:"red",label:({viewBox:s,offset:t})=>e.jsxs("text",{offset:t,x:s.x,y:s.y+30,fill:"red",textAnchor:"end",children:[e.jsx("tspan",{children:f(r==null?void 0:r.diaryTime,{onlyDate:!0})}),e.jsx("tspan",{x:s.x,dy:"20",children:`${j(r==null?void 0:r.weight,{suffix:"kg"})}`})]})})]})})]})},F=()=>{const i=k(n=>n.accessToken),{mutateAsync:c,isPending:g}=N(),o=async()=>{const r=await(await navigator.serviceWorker.register("/life/sw.js")).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:S("BHHkgFHbmZDLJddEeeaA8Bdfz0p1AhXMrS0riDr2vXl5odqtlMW2eBMwppao04oW18eEgF7N36IevHGuv1HiTow")});await c(r)},[x,p]=a.useState([]),{isLoading:u,refetch:h}=A({enabled:!1}),d=async()=>{const n=await h();n.status==="success"&&p([...n.data].filter(r=>r.type==="workout").map(r=>{const s=r.content.match(/\d+(\.\d+)?/);return s?{diaryTime:r.diaryTime,weight:Number(s[0])}:null}).filter(r=>r).sort((r,s)=>Number(r==null?void 0:r.diaryTime)-Number(s==null?void 0:s.diaryTime)))};return e.jsxs("section",{className:"p-4",children:[i&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(y,{onClick:o,isLoading:g,children:"訂閱"}),e.jsx(y,{onClick:d,isLoading:u,children:"取得體重圖"})]}),e.jsx(H,{}),x.length>0&&e.jsx(D,{chartData:x})]})};export{F as default};
