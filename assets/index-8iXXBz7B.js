import{a as O,b as L,r as x,A as h,s as S,f as w,d as m,j as e,B as E}from"./index-B6ltmUFs.js";import{f as A,t as F}from"./format-Btenk6eh.js";import{B as R}from"./index-DSpX8bR2.js";import{B as b}from"./index-CEf_p3wS.js";import{B}from"./index-DEt6d1f3.js";import{B as _}from"./index-C0fiAnYM.js";import{S as $}from"./index-bA8YGstQ.js";import"./floating-ui.react-dom--_5W7nC0.js";import"./focus-management-CbatjrCL.js";import"./field-C2iFIxF1.js";import"./PencilSquareIcon-K08dnf8_.js";import"./BaseSkeleton-DeTKcFG9.js";const I=()=>L({mutationKey:["bitoOrder"],mutationFn:async s=>{var r;const t=await x({method:"post",url:`${h}/cryptoBito`,data:s});return((r=t==null?void 0:t.data)==null?void 0:r.code)===200?(S.success("下單成功"),!0):!1},scope:{id:"bitoOrder"}}),U=()=>L({mutationKey:["bitoCancelOrder"],mutationFn:async s=>{var r;const t=await x({method:"delete",url:`${h}/cryptoBito?orderId=${s}`});return((r=t==null?void 0:t.data)==null?void 0:r.code)===200?(await w(1e3),S.success("取消成功"),!0):!1},scope:{id:"bitoCancelOrder"}}),P=s=>O({queryKey:["getOrderList",s],queryFn:async({signal:t})=>{const a=(await x(`${h}/cryptoAll/orderList?startTime=${s}`,{signal:t})).data.data;return a?Object.fromEntries(Object.entries(a).map(([o,c])=>[o,c.map(n=>({...n,orderTimeStamp:n.orderTimeStamp||n.tradeTimestamp||n.updatedTimestamp,buyOrSell:n.buyOrSell==="2"||n.action==="SELL"?"賣":n.buyOrSell==="1"||n.action==="BUY"?"買":""}))])):null}}),V=()=>O({queryKey:["getBalanceList"],queryFn:async({signal:s})=>{var r,a;const t=await x(`${h}/cryptoAll/balance`,{signal:s});return(r=t==null?void 0:t.data)!=null&&r.data?(a=t==null?void 0:t.data)==null?void 0:a.data:null},select(s){const t=a=>a.reduce((i,{currencyName:o,cashAmount:c})=>(i[o.toLowerCase()]=c,i),{}),r=a=>a.reduce((i,{currency:o,available:c})=>(i[o.toLowerCase()]=c,i),{});return{ace:t(s.ace),ace2:t(s.ace2),bito:r(s.bito)}}}),Y=({colHead:s,rowHead:t,className:r,data:a,isLoading:i,revert:o})=>{const c=m.memo(({rowKey:n,colKey:l,type:j})=>{var y,d;const u=o?(y=a==null?void 0:a[l])==null?void 0:y[n]:(d=a==null?void 0:a[n])==null?void 0:d[l];return j==="dollar"?e.jsx("div",{children:A(u)}):e.jsx("div",{children:u})});return e.jsxs("table",{className:`table w-full table-fixed scroll-mt-14 ${r}`,children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-400",children:[e.jsx("th",{}),s==null?void 0:s.map((n,l)=>e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:n.name},l))]})}),e.jsx("tbody",{children:t==null?void 0:t.map(n=>e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:n.name}),s==null?void 0:s.map(l=>e.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:e.jsx($,{isLoading:i,children:e.jsx(c,{rowKey:n.key,colKey:l.key,type:l.type})})},l.name))]},n.key))})]})},q=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],G=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],K=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],W=({data:s,apiGetData:t,isLoading:r})=>{const[a,i]=m.useState("BUY"),[o,c]=m.useState("twd"),n=[{name:"BNB",value:"bnb"}],[l,j]=m.useState("bnb"),[u,y]=m.useState(""),[d,N]=m.useState("0.05"),{mutateAsync:v,isPending:f}=I(),D=async()=>{await v({action:a,price:u,amount:d,pair:`${l}_${o}`}),t()},{mutateAsync:T,isPending:C}=U(),g=async(p,k)=>{p!=="delete"||C||(await T(s[k].id),t())};return e.jsxs("section",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),e.jsx(b,{radioList:q,value:a,setValue:i,className:"my-2"}),e.jsx(b,{radioList:G,value:o,setValue:c,className:"my-2"}),e.jsx(b,{radioList:n,value:l,setValue:j,className:"my-2"}),e.jsxs("div",{className:"flex w-fit items-start",children:[e.jsx(B,{id:"bitoPrice",value:u,setValue:y,placeholder:"價格"}),e.jsx(B,{id:"bitoAmount",value:d,setValue:N,placeholder:"數量"}),e.jsx(E,{isLoading:f,disabled:f,onClick:D,children:"下單"})]}),e.jsx(_,{headList:K,data:s,lineThrough:p=>(p==null?void 0:p.status)===2,customClick:g,isLoading:r})]})},M=({getWalletAction:s})=>{const[t,r]=m.useState(new Date),{data:a,isFetching:i,refetch:o}=P(F(t).valueOf()),c=()=>{o(),s==null||s()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("h2",{className:"page-title mr-4",children:"下單區"}),e.jsx(R,{value:t,setValue:r,placeholder:"請選擇日期",className:"!w-32"})]}),e.jsx(W,{data:a==null?void 0:a.bito,isLoading:i,apiGetData:c})]})},Q=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],z=[{name:"Bito",key:"bito"}],J=({setGetWalletAction:s})=>{const{data:t,isLoading:r,refetch:a}=V();return m.useEffect(()=>{s(()=>a)},[s,a]),e.jsxs("section",{children:[e.jsx("h2",{className:"page-title",children:"錢包"}),e.jsx(Y,{colHead:Q,rowHead:z,data:t||{},isLoading:r})]})},X=!1,me=()=>{const[s,t]=m.useState(null);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"page-title",children:"加密貨幣"})}),X,e.jsx(M,{getWalletAction:s}),e.jsx(J,{setGetWalletAction:t})]})};export{me as default};
