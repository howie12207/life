import{u as U,a as se,b as K,r as q,A,s as M,c as J,d as a,j as e,B as y,e as ae}from"./index-BLArQMGd.js";import{t as le,a as ne,f as ie}from"./format-Btenk6eh.js";import{B as R}from"./index-dU6rSGNN.js";import{S as re}from"./index-CxpCeOPI.js";import{B as Y}from"./index-B_aBI6eW.js";import{B as oe}from"./index-CE9alSOm.js";import{B as ce}from"./index-BeFtaiRY.js";import{S as de}from"./index-Bt9nh2ve.js";import{i as H,o as ue}from"./validate-DGtL22NN.js";import{T as me}from"./constant-RaoDFmaB.js";import{B as fe}from"./index-CgMiA0CP.js";import{B as ye}from"./index-25y6d1tx.js";import"./floating-ui.react-dom-CUrUag2q.js";import"./PencilSquareIcon-B49O3vVc.js";import"./ChevronRightIcon-D5KIuntN.js";import"./BaseSkeleton-Camewocg.js";import"./focus-management-daiDacl4.js";const he=()=>K({mutationKey:["addSalary"],mutationFn:async t=>{var l;const n=await q({method:"post",url:`${A}/salary`,data:t});return((l=n==null?void 0:n.data)==null?void 0:l.code)===200?(M.success("新增成功"),!0):!1},scope:{id:"addSalary"}}),Se=t=>{const n=U();return se({queryKey:["salaryList",t==null?void 0:t.page,t==null?void 0:t.size,t==null?void 0:t.startTime,t==null?void 0:t.endTime,t==null?void 0:t.place],queryFn:async({signal:l,queryKey:s})=>{var u,m;const h=n.getQueryData(s);if(h)return h;const S=new URLSearchParams;Object.entries(t).forEach(([o,c])=>{c!==void 0&&c!==-1&&S.append(o,String(c))});const p=S.toString()?`?${S.toString()}`:"",r=await q(`${A}/salary/list${p}`,{signal:l});return(u=r==null?void 0:r.data)!=null&&u.data?(m=r==null?void 0:r.data)==null?void 0:m.data:null},staleTime:1e3*60*60,gcTime:1e3*60*60})},xe=()=>K({mutationKey:["editSalary"],mutationFn:async t=>{var l;const n=await q({method:"patch",url:`${A}/salary?_id=${t._id}`,data:t});return((l=n==null?void 0:n.data)==null?void 0:l.code)===200?(M.success("編輯成功"),!0):!1},scope:{id:"editSalary"}}),ge=()=>K({mutationKey:["deleteSalary"],mutationFn:async t=>{var l;const n=await q({method:"delete",url:`${A}/salary?_id=${t}`});return((l=n==null?void 0:n.data)==null?void 0:l.code)===200?(M.success("刪除成功"),!0):!1},scope:{id:"deleteSalary"}}),pe=({isOpen:t,close:n,type:l,data:s,apiGetData:h})=>{const{enqueueSnackbar:S}=J(),p=U(),[r,u]=a.useState(new Date),m=a.useRef(null),[o,c]=a.useState(""),[f,j]=a.useState(!1),b=[{validate:H,message:"請輸入地方"}],P=a.useRef(null),[v,x]=a.useState(""),[_,k]=a.useState(!1),$=[{validate:H,message:"請輸入內容"}],w=a.useRef(null),[B,d]=a.useState(""),[N,T]=a.useState(!1),D=[{validate:ue,message:"請輸入金額"}],[C,i]=a.useState(""),{mutateAsync:V,isPending:g}=he(),{mutateAsync:W,isPending:L}=xe(),Q=async()=>{var z,G,O;if(![(z=m.current)==null?void 0:z.validateNow(),(G=P.current)==null?void 0:G.validateNow(),(O=w.current)==null?void 0:O.validateNow()].every(te=>te))return S("請確認紅框處內容");const F={getDate:le(r).valueOf(),place:o,content:v,dollar:Number(B),remark:C};(l==="add"?await V(F):await W({...F,_id:s==null?void 0:s._id}))&&(p.removeQueries({queryKey:["salaryList"],exact:!1}),h(),E())},{mutateAsync:X,isPending:I}=ge(),Z=async()=>{if(!window.confirm(`確定要刪除『${ne(s==null?void 0:s.getDate,{onlyDate:!0})}』嗎?`)||!(s!=null&&s._id))return;await X(s==null?void 0:s._id)&&(p.removeQueries({queryKey:["salaryList"],exact:!1}),h(),E())};a.useEffect(()=>{!s||!t||l==="add"||(u(new Date(s.getDate)),c(s.place),x(s.content),d(String(s.dollar)),i(s.remark))},[t,s,l]);const E=()=>{n(),u(new Date),c(""),x(""),d(""),i("")};return e.jsx(fe,{isOpen:t,close:E,children:e.jsxs("form",{className:"flex max-h-[80dvh] flex-col",children:[e.jsx("div",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${me[l]||""}薪資`}),e.jsxs("section",{className:"overflow-auto",children:[e.jsx(Y,{label:"發薪日期",value:r,setValue:u,placeholder:"請選擇花費日期"}),e.jsx(R,{className:"mt-5",ref:m,id:"life-place",label:"地方",value:o,setValue:c,isValid:f,setIsValid:j,rules:b,placeholder:"請輸入地方"}),e.jsx(R,{ref:P,id:"life-content",label:"內容",value:v,setValue:x,isValid:_,setIsValid:k,rules:$,placeholder:"請輸入內容"}),e.jsx(R,{ref:w,id:"life-dollar",label:"金額",value:B,setValue:d,isValid:N,setIsValid:T,rules:D,placeholder:"請輸入金額",enter:Q}),e.jsx(ye,{id:"life-note",label:"備註",value:C,setValue:i,placeholder:"請輸入備註"})]}),e.jsxs("div",{className:"mt-8 flex h-auto justify-evenly",children:[e.jsx(y,{isLoading:g||L||I,disabled:g||L||I,onClick:Q,children:"送出"}),l==="edit"&&e.jsx(y,{type:"danger",isLoading:g||L||I,disabled:g||L||I,onClick:Z,children:"刪除"}),e.jsx(y,{type:"info",onClick:E,children:"取消"})]})]})})},je=[{name:"日期",key:"getDate",type:"date"},{name:"地方",key:"place"},{name:"內容",key:"content"},{name:"金額",key:"dollar",type:"dollar"},{name:"備註",key:"remark"},{name:"操作",type:"operation",clickType:"edit"}],$e=()=>{const{enqueueSnackbar:t}=J(),[n,l]=a.useState(""),[s,h]=a.useState(null),S=(i,V)=>{var g;l(i),h(d?(g=d.list)==null?void 0:g[V]:null)},p=()=>{c(void 0),j(void 0),m("")},r=()=>{if(o&&f&&new Date(o)>new Date(f)){t({variant:"error",message:"起始日不能大於結束日"});return}w(1),P({startTime:o==null?void 0:o.valueOf(),endTime:f==null?void 0:f.valueOf(),place:u})},[u,m]=a.useState(""),[o,c]=a.useState(void 0),[f,j]=a.useState(void 0),[b,P]=a.useState({}),v=i=>{i==="thisYear"?(c(new Date(new Date().getFullYear(),0,1,0,0,0,0)),j(void 0)):i==="lastYear"&&(c(new Date(new Date().getFullYear()-1,0,1,0,0,0,0)),j(new Date(new Date().getFullYear()-1,11,31,23,59,59,999)))},[x,_]=a.useState(1),[k,$]=a.useState(10),w=i=>{ae({target:".table"}),_(i)},B=i=>{$(i),w(1)},{data:d,isLoading:N,refetch:T}=Se({page:x-1,size:k,startTime:b.startTime,endTime:b.endTime,place:b.place??void 0});a.useEffect(()=>{T()},[x,T,k]);const D=d==null?void 0:d.list,C=D==null?void 0:D.reduce((i,V)=>i+Number(V.dollar),0);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"page-title",children:"薪資清單"}),e.jsx(y,{onClick:()=>l("add"),children:"新增"})]}),e.jsxs(re,{children:[e.jsx(R,{id:"life-place",label:"地方",value:u,setValue:m,placeholder:"請輸入地方",enter:r}),e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsx(Y,{label:"起始日",value:o,setValue:c,placeholder:"請選擇日期起始"}),e.jsx(Y,{label:"結束日",value:f,setValue:j,placeholder:"請選擇日期結束",minDate:o})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(y,{type:"warning",onClick:()=>v("thisYear"),children:"今年"}),e.jsx(y,{type:"warning",onClick:()=>v("lastYear"),children:"去年"}),e.jsx(y,{onClick:r,children:"搜尋"}),e.jsx(y,{type:"info",onClick:p,children:"重置"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end",children:["累計：",e.jsx(de,{className:"!w-20",isLoading:N,children:ie(C,{type:"dollar"})})]}),e.jsx(oe,{headList:je,data:D,className:"mt-4",customClick:S,isLoading:N}),e.jsx(ce,{nowPage:x,size:k,totalPage:Number((d==null?void 0:d.totalPage)??0),changePage:w,changeSize:B,isLoading:N}),e.jsx(pe,{isOpen:n==="add"||n==="edit",close:()=>l(""),type:n,data:s,apiGetData:T})]})};export{$e as default};
