import{c as J,d as se,e as M,r as q,A,s as Q,f as W,g as a,j as e,T as ae,B as f,u as le,h as ne}from"./index-CyVXoOFO.js";import{t as re,a as ie,f as oe}from"./index-zMglSD1e.js";import{B as R}from"./index-Cngv1zOP.js";import{S as ce}from"./index-Bhzw0V23.js";import{B as K}from"./index-VwafMk3G.js";import{B as ue}from"./index-Cqfhl1oy.js";import{B as de}from"./index-Cjg9NHdz.js";import{S as me}from"./index-L8M40iiq.js";import{i as U,o as fe}from"./index-CYepgPze.js";import{B as ye}from"./index-BhuL4YWG.js";import{B as he}from"./index-Bq7BXDpR.js";import"./bugs-DhYi3BMf.js";import"./use-active-press-CbdhJH1J.js";import"./focus-management-DpQ7tlrU.js";import"./use-resolve-button-type-Djwz04Tx.js";import"./floating-ui.react-dom-E8g74SFu.js";import"./PencilSquareIcon-yksEe_-c.js";import"./ChevronRightIcon-C1hYs2Ym.js";import"./label-DmBk-9BD.js";import"./BaseSkeleton-DvwVxzoM.js";const Se=()=>M({mutationKey:["addSalary"],mutationFn:async t=>await q({method:"post",url:`${A}/salary`,data:t})?(Q.success("新增成功"),!0):!1,scope:{id:"addSalary"}}),xe=t=>{const r=J();return se({queryKey:["salaryList",t==null?void 0:t.page,t==null?void 0:t.size,t==null?void 0:t.startTime,t==null?void 0:t.endTime,t==null?void 0:t.place],queryFn:async({signal:i,queryKey:s})=>{const o=r.getQueryData(s);if(o)return o;const y=new URLSearchParams;Object.entries(t).forEach(([h,c])=>{c!==void 0&&c!==-1&&y.append(h,String(c))});const g=y.toString()?`?${y.toString()}`:"";return await q(`${A}/salary/list${g}`,{signal:i})},staleTime:1e3*60*60,gcTime:1e3*60*60})},pe=()=>M({mutationKey:["editSalary"],mutationFn:async t=>await q({method:"patch",url:`${A}/salary?_id=${t._id}`,data:t})?(Q.success("編輯成功"),!0):!1,scope:{id:"editSalary"}}),ge=()=>M({mutationKey:["deleteSalary"],mutationFn:async t=>await q({method:"delete",url:`${A}/salary?_id=${t}`})?(Q.success("刪除成功"),!0):!1,scope:{id:"deleteSalary"}}),je=({isOpen:t,close:r,type:i,data:s,apiGetData:o})=>{const{enqueueSnackbar:y}=W(),g=J(),[b,h]=a.useState(new Date),c=a.useRef(null),[v,j]=a.useState(""),[u,w]=a.useState(!1),d=[{validate:U,message:"請輸入地方"}],S=a.useRef(null),[D,k]=a.useState(""),[P,B]=a.useState(!1),_=[{validate:U,message:"請輸入內容"}],T=a.useRef(null),[C,x]=a.useState(""),[$,n]=a.useState(!1),N=[{validate:fe,message:"請輸入金額"}],[L,m]=a.useState(""),{mutateAsync:F,isPending:l}=Se(),{mutateAsync:V,isPending:p}=pe(),z=async()=>{var G,O,H;if(![(G=c.current)==null?void 0:G.validateNow(),(O=S.current)==null?void 0:O.validateNow(),(H=T.current)==null?void 0:H.validateNow()].every(te=>te))return y("請確認紅框處內容");const Y={getDate:re(b).valueOf(),place:v,content:D,dollar:Number(C),remark:L};(i==="add"?await F(Y):await V({...Y,_id:s==null?void 0:s._id}))&&(g.removeQueries({queryKey:["salaryList"],exact:!1}),o(),E())},{mutateAsync:X,isPending:I}=ge(),Z=async()=>{if(!window.confirm(`確定要刪除『${ie(s==null?void 0:s.getDate,{onlyDate:!0})}』嗎?`)||!(s!=null&&s._id))return;await X(s==null?void 0:s._id)&&(g.removeQueries({queryKey:["salaryList"],exact:!1}),o(),E())};a.useEffect(()=>{!s||!t||i==="add"||(h(new Date(s.getDate)),j(s.place),k(s.content),x(String(s.dollar)),m(s.remark))},[t,s,i]);const E=()=>{r(),h(new Date),j(""),k(""),x(""),m("")};return e.jsx(ye,{isOpen:t,close:E,children:e.jsxs("form",{className:"flex max-h-[80dvh] flex-col",children:[e.jsx("div",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${ae[i]||""}薪資`}),e.jsxs("section",{className:"overflow-auto",children:[e.jsx(K,{label:"發薪日期",value:b,setValue:h,placeholder:"請選擇花費日期"}),e.jsx(R,{className:"mt-5",ref:c,id:"life-place",label:"地方",value:v,setValue:j,isValid:u,setIsValid:w,rules:d,placeholder:"請輸入地方"}),e.jsx(R,{ref:S,id:"life-content",label:"內容",value:D,setValue:k,isValid:P,setIsValid:B,rules:_,placeholder:"請輸入內容"}),e.jsx(R,{ref:T,id:"life-dollar",label:"金額",value:C,setValue:x,isValid:$,setIsValid:n,rules:N,placeholder:"請輸入金額",enter:z}),e.jsx(he,{id:"life-note",label:"備註",value:L,setValue:m,placeholder:"請輸入備註"})]}),e.jsxs("div",{className:"mt-8 flex h-auto justify-evenly",children:[e.jsx(f,{isLoading:l||p||I,disabled:l||p||I,onClick:z,children:"送出"}),i==="edit"&&e.jsx(f,{type:"danger",isLoading:l||p||I,disabled:l||p||I,onClick:Z,children:"刪除"}),e.jsx(f,{type:"info",onClick:E,children:"取消"})]})]})})},Ke=()=>{const{enqueueSnackbar:t}=W(),r=le(l=>l.accessToken),i=[{name:"日期",key:"getDate",type:"date"},{name:"地方",key:"place"},{name:"內容",key:"content"},{name:"金額",key:"dollar",type:"dollar"},{name:"備註",key:"remark"},...r?[{name:"操作",type:"operation",clickType:"edit"}]:[]],[s,o]=a.useState(""),[y,g]=a.useState(null),b=(l,V)=>{var p;o(l),g(n?(p=n.list)==null?void 0:p[V]:null)},h=()=>{w(void 0),S(void 0),j("")},c=()=>{if(u&&d&&new Date(u)>new Date(d)){t({variant:"error",message:"起始日不能大於結束日"});return}x(1),k({startTime:u==null?void 0:u.valueOf(),endTime:d==null?void 0:d.valueOf(),place:v})},[v,j]=a.useState(""),[u,w]=a.useState(void 0),[d,S]=a.useState(void 0),[D,k]=a.useState({}),P=l=>{l==="thisYear"?(w(new Date(new Date().getFullYear(),0,1,0,0,0,0)),S(void 0)):l==="lastYear"&&(w(new Date(new Date().getFullYear()-1,0,1,0,0,0,0)),S(new Date(new Date().getFullYear()-1,11,31,23,59,59,999)))},[B,_]=a.useState(1),[T,C]=a.useState(10),x=l=>{ne({target:".base-table"}),_(l)},$=l=>{C(l),x(1)},{data:n,isLoading:N,refetch:L}=xe({page:B-1,size:T,startTime:D.startTime,endTime:D.endTime,place:D.place??void 0}),m=n==null?void 0:n.list,F=m==null?void 0:m.reduce((l,V)=>l+Number(V.dollar),0);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"page-title",children:"薪資清單"}),r&&e.jsx(f,{onClick:()=>o("add"),children:"新增"})]}),e.jsxs(ce,{children:[e.jsx(R,{id:"life-place",label:"地方",value:v,setValue:j,placeholder:"請輸入地方",enter:c}),e.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[e.jsx(K,{label:"起始日",value:u,setValue:w,placeholder:"請選擇日期起始"}),e.jsx(K,{label:"結束日",value:d,setValue:S,placeholder:"請選擇日期結束",minDate:u})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx(f,{type:"warning",onClick:()=>P("thisYear"),children:"今年"}),e.jsx(f,{type:"warning",onClick:()=>P("lastYear"),children:"去年"}),e.jsx(f,{onClick:c,children:"搜尋"}),e.jsx(f,{type:"info",onClick:h,children:"重置"})]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-end",children:["累計：",e.jsx(me,{className:"w-20",isLoading:N,children:oe(F,{type:"dollar"})})]}),e.jsx(ue,{headList:i,data:m,className:"mt-4",customClick:b,isLoading:N}),e.jsx(de,{nowPage:B,size:T,totalPage:Number((n==null?void 0:n.totalPage)??0),changePage:x,changeSize:$,isLoading:N}),e.jsx(je,{isOpen:s==="add"||s==="edit",close:()=>o(""),type:s,data:y,apiGetData:L})]})};export{Ke as default};
