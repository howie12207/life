import{a as L,b as S,r as x,A as h,s as N,g as A,d as m,j as e,c as F,e as R,B as _}from"./index-C_SaourX.js";import{f as $,t as I}from"./format-Btenk6eh.js";import{B as U}from"./index-CGdXDYsN.js";import{B as j}from"./index-DoLswD8p.js";import{B as O}from"./index-CKdGVYno.js";import{B as q}from"./index-B7W8l2u8.js";import{S as P}from"./index-Bvv___Dr.js";import"./floating-ui.react-dom-CFrcqmY7.js";import"./bugs-DrBqCKKs.js";import"./field-BL2o4WA6.js";import"./focus-management-Dc5kYah-.js";import"./label-ClcyPzcb.js";import"./PencilSquareIcon-BVoEPK7x.js";import"./BaseSkeleton-iL-5NRq0.js";const V=()=>S({mutationKey:["bitoOrder"],mutationFn:async s=>{var n;const t=await x({method:"post",url:`${h}/cryptoBito`,data:s});return((n=t==null?void 0:t.data)==null?void 0:n.code)===200?(N.success("下單成功"),!0):!1},scope:{id:"bitoOrder"}}),Y=()=>S({mutationKey:["bitoCancelOrder"],mutationFn:async s=>{var n;const t=await x({method:"delete",url:`${h}/cryptoBito?orderId=${s}`});return((n=t==null?void 0:t.data)==null?void 0:n.code)===200?(await A(1e3),N.success("取消成功"),!0):!1},scope:{id:"bitoCancelOrder"}}),G=s=>L({queryKey:["getOrderList",s],queryFn:async({signal:t})=>{const a=(await x(`${h}/cryptoAll/orderList?startTime=${s}`,{signal:t})).data.data;return a?Object.fromEntries(Object.entries(a).map(([c,o])=>[c,o.map(r=>({...r,orderTimeStamp:r.orderTimeStamp||r.tradeTimestamp||r.updatedTimestamp,buyOrSell:r.buyOrSell==="2"||r.action==="SELL"?"賣":r.buyOrSell==="1"||r.action==="BUY"?"買":""}))])):null}}),K=()=>L({queryKey:["getBalanceList"],queryFn:async({signal:s})=>{var n,a;const t=await x(`${h}/cryptoAll/balance`,{signal:s});return(n=t==null?void 0:t.data)!=null&&n.data?(a=t==null?void 0:t.data)==null?void 0:a.data:null},select(s){const t=a=>a.reduce((i,{currencyName:c,cashAmount:o})=>(i[c.toLowerCase()]=o,i),{}),n=a=>a.reduce((i,{currency:c,available:o})=>(i[c.toLowerCase()]=o,i),{});return{ace:t(s.ace),ace2:t(s.ace2),bito:n(s.bito)}}}),W=({colHead:s,rowHead:t,className:n,data:a,isLoading:i,revert:c})=>{const o=m.memo(({rowKey:r,colKey:l,type:b})=>{var y,p;const d=c?(y=a==null?void 0:a[l])==null?void 0:y[r]:(p=a==null?void 0:a[r])==null?void 0:p[l];return b==="dollar"?e.jsx("div",{children:$(d)}):e.jsx("div",{children:d})});return e.jsxs("table",{className:`table w-full table-fixed scroll-mt-14 ${n}`,children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-400",children:[e.jsx("th",{}),s==null?void 0:s.map((r,l)=>e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name},l))]})}),e.jsx("tbody",{children:t==null?void 0:t.map(r=>e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name}),s==null?void 0:s.map(l=>e.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:e.jsx(P,{isLoading:i,children:e.jsx(o,{rowKey:r.key,colKey:l.key,type:l.type})})},l.name))]},r.key))})]})},M=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],Q=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],z=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],J=({data:s,apiGetData:t,isLoading:n})=>{const{enqueueSnackbar:a}=F(),i=R(u=>u.accessToken),[c,o]=m.useState("BUY"),[r,l]=m.useState("twd"),b=[{name:"BNB",value:"bnb"}],[d,y]=m.useState("bnb"),[p,v]=m.useState(""),[f,D]=m.useState("0.05"),{mutateAsync:T,isPending:B}=V(),k=async()=>{if(!i){a("請先登入");return}await T({action:c,price:p,amount:f,pair:`${d}_${r}`}),t()},{mutateAsync:g,isPending:C}=Y(),w=async(u,E)=>{if(!i){a("請先登入");return}u!=="delete"||C||(await g(s[E].id),t())};return e.jsxs("section",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),e.jsx(j,{radioList:M,value:c,setValue:o,className:"my-2"}),e.jsx(j,{radioList:Q,value:r,setValue:l,className:"my-2"}),e.jsx(j,{radioList:b,value:d,setValue:y,className:"my-2"}),e.jsxs("div",{className:"flex w-fit items-start",children:[e.jsx(O,{id:"bitoPrice",value:p,setValue:v,placeholder:"價格"}),e.jsx(O,{id:"bitoAmount",value:f,setValue:D,placeholder:"數量"}),e.jsx(_,{isLoading:B,disabled:B,onClick:k,children:"下單"})]}),e.jsx(q,{headList:z,data:s,lineThrough:u=>(u==null?void 0:u.status)===2,customClick:w,isLoading:n})]})},X=({getWalletAction:s})=>{const[t,n]=m.useState(new Date),{data:a,isFetching:i,refetch:c}=G(I(t).valueOf()),o=()=>{c(),s==null||s()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("h2",{className:"page-title mr-4",children:"下單區"}),e.jsx(U,{value:t,setValue:n,placeholder:"請選擇日期",className:"!w-32"})]}),e.jsx(J,{data:a==null?void 0:a.bito,isLoading:i,apiGetData:o})]})},Z=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],H=[{name:"Bito",key:"bito"}],ee=({setGetWalletAction:s})=>{const{data:t,isLoading:n,refetch:a}=K();return m.useEffect(()=>{s(()=>a)},[s,a]),e.jsxs("section",{children:[e.jsx("h2",{className:"page-title",children:"錢包"}),e.jsx(W,{colHead:Z,rowHead:H,data:t||{},isLoading:n})]})},te=!1,he=()=>{const[s,t]=m.useState(null);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"page-title",children:"加密貨幣"})}),te,e.jsx(X,{getWalletAction:s}),e.jsx(ee,{setGetWalletAction:t})]})};export{he as default};
