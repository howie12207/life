import{c as ee,d as Ie,e as B,f as U,A as P,s as L,r as l,j as e,Y as ye,Z as we,$ as Ue,t as W,u as se,B as b,g as Pe,T as Ce}from"./index-DRGgUxba.js";import{B as Re}from"./BaseSkeleton-B3nqbHgR.js";import{M as Ee}from"./MutiSkeleton-D4UNwPo0.js";import{F as De}from"./PencilSquareIcon-D1qIZXW7.js";import{i as ke,a as w,o as Ae}from"./index-CYepgPze.js";import{B as Be}from"./index-BOdi_nzb.js";import{B as j}from"./index-CC7g3jXk.js";import{B as Le}from"./index-CNhnWV-r.js";import{B as Te}from"./index-C8jbHxpn.js";import"./focus-management-D-6Xrzak.js";import"./bugs-DuTx37BJ.js";import"./field-D_Ydg4mx.js";import"./label-gXIVgJfb.js";const _e=()=>B({mutationKey:["addPortfolio"],mutationFn:async s=>await U({method:"post",url:`${P}/portfolio`,data:s})?(L.success("新增成功"),!0):!1,scope:{id:"addPortfolio"}}),$e=s=>{const i=ee();return Ie({queryKey:["portfolioList",s==null?void 0:s.page,s==null?void 0:s.size],queryFn:async({signal:r,queryKey:t})=>{const d=i.getQueryData(t);if(d)return d;const n=new URLSearchParams;Object.entries(s).forEach(([f,o])=>{o!==void 0&&o!==-1&&n.append(f,String(o))});const u=n.toString()?`?${n.toString()}`:"";return await U(`${P}/portfolio/list${u}`,{signal:r})},staleTime:1e3*60*60,gcTime:1e3*60*60})},qe=()=>B({mutationKey:["editPortfolio"],mutationFn:async s=>await U({method:"patch",url:`${P}/portfolio?_id=${s._id}`,data:s})?(L.success("編輯成功"),!0):!1,scope:{id:"editPortfolio"}}),Oe=()=>B({mutationKey:["deletePortfolio"],mutationFn:async s=>await U({method:"delete",url:`${P}/portfolio?_id=${s}`})?(L.success("刪除成功"),!0):!1,scope:{id:"deletePortfolio"}});function Fe(s,{threshold:i=0,root:r=null,rootMargin:t="0%",freezeOnceVisible:d=!1}={}){const[n,u]=l.useState(),m=n==null?void 0:n.isIntersecting,f=m&&d,o=([h])=>{u(h)};return l.useEffect(()=>{const h=s==null?void 0:s.current;if(!!!window.IntersectionObserver||f||!h)return;const a={threshold:i,root:r,rootMargin:t},x=new IntersectionObserver(o,a);return x.observe(h),()=>x.disconnect()},[s,r,t,f,i]),{entry:n,inView:m}}const Me=({src:s,alt:i})=>{const[r,t]=l.useState(!0),d=()=>{t(!1)};return e.jsx(ye,{mode:"wait",children:e.jsxs(we.div,{className:"relative",...Ue,children:[e.jsx("img",{src:s,alt:i,className:W(["aspect-video w-full object-cover transition",r&&"absolute opacity-0"]),loading:"lazy",onLoad:d}),e.jsx(Re,{className:W([!r&&"absolute hidden","h-[280px]"])})]},String(r))})},X=({data:s,handleEdit:i})=>{const r=se(t=>t.accessToken);return e.jsxs("article",{className:"relative h-full overflow-hidden rounded border border-red-50 bg-red-50 shadow transition hover:shadow-xl",children:[e.jsx(Me,{src:s.img,alt:s.name}),e.jsx("div",{className:"p-4",children:e.jsxs(Ee,{isLoading:!s.img,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-red-700",children:s.name}),r&&e.jsx(b,{type:"icon",className:"text-blue-700",onClick:i,children:e.jsx(De,{className:"size-4"})})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.content}),e.jsxs("div",{className:"mt-2 flex gap-4",children:[s.pathDemo&&e.jsx("a",{href:s.pathDemo,className:"text-blue-500 hover:underline",title:"demo",target:"_blank",children:"Demo"}),s.pathCode&&e.jsx("a",{href:s.pathCode,className:"text-blue-500 hover:underline",title:"code",target:"_blank",children:"Code"}),s.url&&e.jsx("a",{href:s.url,className:"text-blue-500 hover:underline",title:"article",target:"_blank",children:"Article"})]})]})})]})},Ke=[{name:"是",value:"true"},{name:"否",value:"false"}],ze=({isOpen:s,close:i,type:r,data:t,apiGetData:d})=>{const{enqueueSnackbar:n}=Pe(),u=ee(),m=l.useRef(null),[f,o]=l.useState(""),[h,N]=l.useState(!1),a=[{validate:ke,message:"請輸入作品名稱"}],[x,g]=l.useState(""),v=l.useRef(null),[c,p]=l.useState(""),[te,le]=l.useState(!1),oe=[{validate:w,message:"請輸入圖片連結"}],T=l.useRef(null),[_,C]=l.useState(""),[re,ie]=l.useState(!1),ne=[{validate:w,message:"請輸入程式碼連結"}],$=l.useRef(null),[q,R]=l.useState(""),[ae,ce]=l.useState(!1),de=[{validate:w,message:"請輸入Demo連結"}],O=l.useRef(null),[F,E]=l.useState(""),[ue,me]=l.useState(!1),fe=[{validate:w,message:"請輸入文章連結"}],M=l.useRef(null),[K,D]=l.useState(""),[he,xe]=l.useState(!1),pe=[{validate:Ae,message:"請輸入排序"}],[z,k]=l.useState("true"),{mutateAsync:ge,isPending:S}=_e(),{mutateAsync:je,isPending:V}=qe(),ve=async()=>{var Q,G,Z,Y,H,J;if(![(Q=m.current)==null?void 0:Q.validateNow(),(G=v.current)==null?void 0:G.validateNow(),(Z=T.current)==null?void 0:Z.validateNow(),(Y=$.current)==null?void 0:Y.validateNow(),(H=O.current)==null?void 0:H.validateNow(),(J=M.current)==null?void 0:J.validateNow()].every(Ve=>Ve))return n("請確認紅框處內容");const A={name:f,content:x,img:c,pathCode:_,pathDemo:q,url:F,order:Number(K),recommend:z==="true",status:1};(r==="add"?await ge(A):await je({...A,_id:t==null?void 0:t._id}))&&(u.removeQueries({queryKey:["portfolioList"],exact:!1}),d(),y())},{mutateAsync:be,isPending:I}=Oe(),Ne=async()=>{if(!window.confirm(`確定要刪除『${t==null?void 0:t.name}』嗎?`)||!(t!=null&&t._id))return;await be(t==null?void 0:t._id)&&(u.removeQueries({queryKey:["portfolioList"],exact:!1}),d(),y())};l.useEffect(()=>{!t||!s||r==="add"||(o(t.name),g(t.content),p(t.img),C(t.pathCode),R(t.pathDemo),E(t.url),D(String(t.order)),k(String(t.recommend)))},[s,t,r]);const y=()=>{i(),o(""),g(""),p(""),C(""),R(""),E(""),D(""),k("true")};return e.jsx(Be,{isOpen:s,close:y,children:e.jsxs("form",{className:"flex max-h-[80dvh] flex-col",children:[e.jsx("div",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${Ce[r]||""}作品`}),e.jsxs("section",{className:"overflow-auto",children:[e.jsx(j,{ref:m,id:"life-name",label:"作品名稱",value:f,setValue:o,isValid:h,setIsValid:N,rules:a,placeholder:"請輸入作品名稱",autoFocus:!0}),e.jsx(Le,{id:"life-content",label:"描述",value:x,setValue:g,placeholder:"請輸入描述"}),e.jsx(j,{className:"mt-5",ref:v,id:"life-imgUrl",label:"圖片網址",value:c,setValue:p,isValid:te,setIsValid:le,rules:oe,placeholder:"請輸入圖片網址"}),e.jsx(j,{ref:T,id:"life-codeUrl",label:"程式碼網址",value:_,setValue:C,isValid:re,setIsValid:ie,rules:ne,placeholder:"請輸入程式碼網址"}),e.jsx(j,{ref:$,id:"life-demoUrl",label:"Demo網址",value:q,setValue:R,isValid:ae,setIsValid:ce,rules:de,placeholder:"請輸入Demo網址"}),e.jsx(j,{ref:O,id:"life-articleUrl",label:"文章網址",value:F,setValue:E,isValid:ue,setIsValid:me,rules:fe,placeholder:"請輸入文章網址"}),e.jsx(j,{ref:M,id:"life-order",label:"排序",value:K,setValue:D,isValid:he,setIsValid:xe,rules:pe,placeholder:"請輸入排序"}),e.jsx("label",{className:"base-label",children:"是否推薦"}),e.jsx(Te,{radioList:Ke,value:z,setValue:k})]}),e.jsxs("div",{className:"mt-8 flex h-auto justify-evenly",children:[e.jsx(b,{isLoading:S||V||I,disabled:S||V||I,onClick:ve,children:"送出"}),r==="edit"&&e.jsx(b,{type:"danger",isLoading:S||V||I,disabled:S||V||I,onClick:Ne,children:"刪除"}),e.jsx(b,{type:"info",onClick:y,children:"取消"})]})]})})},is=()=>{const s=se(c=>c.accessToken),[i,r]=l.useState(""),[t,d]=l.useState(null),n=(c,p)=>{r(c),d(a?a==null?void 0:a[p]:null)},[u,m]=l.useState(1),f=9,{data:o,refetch:h}=$e({page:u-1,size:f}),N=()=>{x([]),m(1),h()},[a,x]=l.useState([]);l.useEffect(()=>{o!=null&&o.list&&x(c=>[...c,...o.list])},[o]);const g=l.useRef(null),{inView:v}=Fe(g);return l.useEffect(()=>{v&&Number(o==null?void 0:o.totalPage)>u&&m(c=>c+1)},[v]),e.jsxs("main",{className:"p-4 pb-16",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"page-title",children:"作品集"}),s&&e.jsx(b,{onClick:()=>r("add"),children:"新增"})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[a==null?void 0:a.map((c,p)=>e.jsx(X,{data:c,handleEdit:()=>n("edit",p)},p)),e.jsx("div",{ref:g,children:a.length!==(o==null?void 0:o.totalCount)&&e.jsx(X,{data:{},handleEdit:()=>n("edit",0)})})]}),e.jsx(ze,{isOpen:i==="add"||i==="edit",close:()=>r(""),type:i,data:t,apiGetData:N})]})};export{is as default};
