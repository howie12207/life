import{u as ee,a as Ie,b as B,r as U,A as P,s as L,d as l,j as e,U as ye,V as we,W as Ue,t as X,e as se,B as N,c as Pe,T as Ce}from"./index-BsT9PFH1.js";import{B as Re}from"./BaseSkeleton-DQlQ6vKD.js";import{M as Ee}from"./MutiSkeleton-CCvj0tXY.js";import{F as De}from"./PencilSquareIcon-BHWd3W6i.js";import{i as ke,a as w,o as Ae}from"./validate-C1sTg8Ed.js";import{B as Be}from"./index-ByU6m4XI.js";import{B as v}from"./index-D8YX5iPM.js";import{B as Le}from"./index-DVCoHyIL.js";import{B as Te}from"./index-C_qIEhzP.js";import"./focus-management-Bxz331r8.js";import"./bugs-_ZnruFTO.js";import"./field-BTel7PYk.js";import"./label-Dle3GftA.js";const _e=()=>B({mutationKey:["addPortfolio"],mutationFn:async s=>{var o;const r=await U({method:"post",url:`${P}/portfolio`,data:s});return((o=r==null?void 0:r.data)==null?void 0:o.code)===200?(L.success("新增成功"),!0):!1},scope:{id:"addPortfolio"}}),qe=s=>{const r=ee();return Ie({queryKey:["portfolioList",s==null?void 0:s.page,s==null?void 0:s.size],queryFn:async({signal:o,queryKey:t})=>{var m,i;const u=r.getQueryData(t);if(u)return u;const n=new URLSearchParams;Object.entries(s).forEach(([f,x])=>{x!==void 0&&x!==-1&&n.append(f,String(x))});const h=n.toString()?`?${n.toString()}`:"",a=await U(`${P}/portfolio/list${h}`,{signal:o});return(m=a==null?void 0:a.data)!=null&&m.data?(i=a==null?void 0:a.data)==null?void 0:i.data:null},staleTime:1e3*60*60,gcTime:1e3*60*60})},Oe=()=>B({mutationKey:["editPortfolio"],mutationFn:async s=>{var o;const r=await U({method:"patch",url:`${P}/portfolio?_id=${s._id}`,data:s});return((o=r==null?void 0:r.data)==null?void 0:o.code)===200?(L.success("編輯成功"),!0):!1},scope:{id:"editPortfolio"}}),$e=()=>B({mutationKey:["deletePortfolio"],mutationFn:async s=>{var o;const r=await U({method:"delete",url:`${P}/portfolio?_id=${s}`});return((o=r==null?void 0:r.data)==null?void 0:o.code)===200?(L.success("刪除成功"),!0):!1},scope:{id:"deletePortfolio"}});function Me(s,{threshold:r=0,root:o=null,rootMargin:t="0%",freezeOnceVisible:u=!1}={}){const[n,h]=l.useState(),a=n==null?void 0:n.isIntersecting,m=a&&u,i=([f])=>{h(f)};return l.useEffect(()=>{const f=s==null?void 0:s.current;if(!!!window.IntersectionObserver||m||!f)return;const c={threshold:r,root:o,rootMargin:t},p=new IntersectionObserver(i,c);return p.observe(f),()=>p.disconnect()},[s,o,t,m,r]),{entry:n,inView:a}}const Fe=({src:s,alt:r})=>{const[o,t]=l.useState(!0),u=()=>{t(!1)};return e.jsx(ye,{mode:"wait",children:e.jsxs(we.div,{className:"relative",...Ue,children:[e.jsx("img",{src:s,alt:r,className:X(["aspect-video w-full object-cover transition",o&&"absolute opacity-0"]),loading:"lazy",onLoad:u}),e.jsx(Re,{className:X([!o&&"absolute hidden","h-[280px]"])})]},String(o))})},Y=({data:s,handleEdit:r})=>{const o=se(t=>t.accessToken);return e.jsxs("article",{className:"relative h-full overflow-hidden rounded border border-red-50 bg-red-50 shadow transition hover:shadow-xl",children:[e.jsx(Fe,{src:s.img,alt:s.name}),e.jsx("div",{className:"p-4",children:e.jsxs(Ee,{isLoading:!s.img,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-red-700",children:s.name}),o&&e.jsx(N,{type:"icon",className:"text-blue-700",onClick:r,children:e.jsx(De,{className:"size-4"})})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.content}),e.jsxs("div",{className:"mt-2 flex gap-4",children:[s.pathDemo&&e.jsx("a",{href:s.pathDemo,className:"text-blue-500 hover:underline",title:"demo",target:"_blank",children:"Demo"}),s.pathCode&&e.jsx("a",{href:s.pathCode,className:"text-blue-500 hover:underline",title:"code",target:"_blank",children:"Code"}),s.url&&e.jsx("a",{href:s.url,className:"text-blue-500 hover:underline",title:"article",target:"_blank",children:"Article"})]})]})})]})},Ke=[{name:"是",value:"true"},{name:"否",value:"false"}],ze=({isOpen:s,close:r,type:o,data:t,apiGetData:u})=>{const{enqueueSnackbar:n}=Pe(),h=ee(),a=l.useRef(null),[m,i]=l.useState(""),[f,x]=l.useState(!1),c=[{validate:ke,message:"請輸入作品名稱"}],[p,j]=l.useState(""),b=l.useRef(null),[d,g]=l.useState(""),[te,le]=l.useState(!1),oe=[{validate:w,message:"請輸入圖片連結"}],T=l.useRef(null),[_,C]=l.useState(""),[re,ie]=l.useState(!1),ae=[{validate:w,message:"請輸入程式碼連結"}],q=l.useRef(null),[O,R]=l.useState(""),[ne,ce]=l.useState(!1),de=[{validate:w,message:"請輸入Demo連結"}],$=l.useRef(null),[M,E]=l.useState(""),[ue,me]=l.useState(!1),fe=[{validate:w,message:"請輸入文章連結"}],F=l.useRef(null),[K,D]=l.useState(""),[he,xe]=l.useState(!1),pe=[{validate:Ae,message:"請輸入排序"}],[z,k]=l.useState("true"),{mutateAsync:ge,isPending:S}=_e(),{mutateAsync:je,isPending:V}=Oe(),ve=async()=>{var Q,G,W,Z,H,J;if(![(Q=a.current)==null?void 0:Q.validateNow(),(G=b.current)==null?void 0:G.validateNow(),(W=T.current)==null?void 0:W.validateNow(),(Z=q.current)==null?void 0:Z.validateNow(),(H=$.current)==null?void 0:H.validateNow(),(J=F.current)==null?void 0:J.validateNow()].every(Ve=>Ve))return n("請確認紅框處內容");const A={name:m,content:p,img:d,pathCode:_,pathDemo:O,url:M,order:Number(K),recommend:z==="true",status:1};(o==="add"?await ge(A):await je({...A,_id:t==null?void 0:t._id}))&&(h.removeQueries({queryKey:["portfolioList"],exact:!1}),u(),y())},{mutateAsync:be,isPending:I}=$e(),Ne=async()=>{if(!window.confirm(`確定要刪除『${t==null?void 0:t.name}』嗎?`)||!(t!=null&&t._id))return;await be(t==null?void 0:t._id)&&(h.removeQueries({queryKey:["portfolioList"],exact:!1}),u(),y())};l.useEffect(()=>{!t||!s||o==="add"||(i(t.name),j(t.content),g(t.img),C(t.pathCode),R(t.pathDemo),E(t.url),D(String(t.order)),k(String(t.recommend)))},[s,t,o]);const y=()=>{r(),i(""),j(""),g(""),C(""),R(""),E(""),D(""),k("true")};return e.jsx(Be,{isOpen:s,close:y,children:e.jsxs("form",{className:"flex max-h-[80dvh] flex-col",children:[e.jsx("div",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${Ce[o]||""}作品`}),e.jsxs("section",{className:"overflow-auto",children:[e.jsx(v,{ref:a,id:"life-name",label:"作品名稱",value:m,setValue:i,isValid:f,setIsValid:x,rules:c,placeholder:"請輸入作品名稱"}),e.jsx(Le,{id:"life-content",label:"描述",value:p,setValue:j,placeholder:"請輸入描述"}),e.jsx(v,{className:"mt-5",ref:b,id:"life-imgUrl",label:"圖片網址",value:d,setValue:g,isValid:te,setIsValid:le,rules:oe,placeholder:"請輸入圖片網址"}),e.jsx(v,{ref:T,id:"life-codeUrl",label:"程式碼網址",value:_,setValue:C,isValid:re,setIsValid:ie,rules:ae,placeholder:"請輸入程式碼網址"}),e.jsx(v,{ref:q,id:"life-demoUrl",label:"Demo網址",value:O,setValue:R,isValid:ne,setIsValid:ce,rules:de,placeholder:"請輸入Demo網址"}),e.jsx(v,{ref:$,id:"life-articleUrl",label:"文章網址",value:M,setValue:E,isValid:ue,setIsValid:me,rules:fe,placeholder:"請輸入文章網址"}),e.jsx(v,{ref:F,id:"life-order",label:"排序",value:K,setValue:D,isValid:he,setIsValid:xe,rules:pe,placeholder:"請輸入排序"}),e.jsx("label",{className:"base-label",children:"是否推薦"}),e.jsx(Te,{radioList:Ke,value:z,setValue:k})]}),e.jsxs("div",{className:"mt-8 flex h-auto justify-evenly",children:[e.jsx(N,{isLoading:S||V||I,disabled:S||V||I,onClick:ve,children:"送出"}),o==="edit"&&e.jsx(N,{type:"danger",isLoading:S||V||I,disabled:S||V||I,onClick:Ne,children:"刪除"}),e.jsx(N,{type:"info",onClick:y,children:"取消"})]})]})})},is=()=>{const s=se(d=>d.accessToken),[r,o]=l.useState(""),[t,u]=l.useState(null),n=(d,g)=>{o(d),u(c?c==null?void 0:c[g]:null)},[h,a]=l.useState(1),m=9,{data:i,refetch:f}=qe({page:h-1,size:m}),x=()=>{p([]),a(1),f()},[c,p]=l.useState([]);l.useEffect(()=>{i!=null&&i.list&&p(d=>[...d,...i.list])},[i]);const j=l.useRef(null),{inView:b}=Me(j);return l.useEffect(()=>{b&&Number(i==null?void 0:i.totalPage)>h&&a(d=>d+1)},[b]),e.jsxs("main",{className:"p-4 pb-16",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"page-title",children:"作品集"}),s&&e.jsx(N,{onClick:()=>o("add"),children:"新增"})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[c==null?void 0:c.map((d,g)=>e.jsx(Y,{data:d,handleEdit:()=>n("edit",g)},g)),e.jsx("div",{ref:j,children:c.length!==(i==null?void 0:i.totalCount)&&e.jsx(Y,{data:{},handleEdit:()=>n("edit",0)})})]}),e.jsx(ze,{isOpen:r==="add"||r==="edit",close:()=>o(""),type:r,data:t,apiGetData:x})]})};export{is as default};
