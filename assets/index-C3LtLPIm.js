import{d as g,e as v,f as d,A as p,s as D,i as K,k as E,D as $,r as m,j as e,t as W,g as q,u as I,B as U}from"./index-DRGgUxba.js";import{a as _,t as Y}from"./index-B4S751B2.js";import{B as M}from"./index-BKED-_qM.js";import{B as O}from"./index-C8jbHxpn.js";import{B as j}from"./index-CC7g3jXk.js";import{B as R}from"./index-CuI7qpu_.js";import{S as Q}from"./index-DT19r4sW.js";import"./floating-ui.react-dom-DYb6uyNO.js";import"./bugs-DuTx37BJ.js";import"./field-D_Ydg4mx.js";import"./focus-management-D-6Xrzak.js";import"./label-gXIVgJfb.js";import"./PencilSquareIcon-D1qIZXW7.js";import"./BaseSkeleton-B3nqbHgR.js";const X=()=>v({mutationKey:["bitoOrder"],mutationFn:async t=>await d({method:"post",url:`${p}/cryptoBito`,data:t})?(D.success("下單成功"),!0):!1,scope:{id:"bitoOrder"}}),z=()=>v({mutationKey:["bitoCancelOrder"],mutationFn:async t=>await d({method:"delete",url:`${p}/cryptoBito?orderId=${t}`})?(await K(1e3),D.success("取消成功"),!0):!1,scope:{id:"bitoCancelOrder"}}),J=t=>g({queryKey:["getOrderList",t],queryFn:async({signal:n})=>{const a=await d(`${p}/cryptoAll/orderList?startTime=${t}`,{signal:n});return a?Object.fromEntries(Object.entries(a).map(([i,l])=>[i,l.map(r=>({...r,orderTimeStamp:r.orderTimeStamp||r.tradeTimestamp||r.updatedTimestamp,buyOrSell:r.buyOrSell==="2"||r.action==="SELL"?"賣":r.buyOrSell==="1"||r.action==="BUY"?"買":""}))])):null}}),Z=()=>g({queryKey:["getBalanceList"],queryFn:async({signal:t})=>await d(`${p}/cryptoAll/balance`,{signal:t}),select(t){const n=s=>s?s.reduce((i,{currencyName:l,cashAmount:r})=>(i[l.toLowerCase()]=r,i),{}):{},a=s=>s?s.reduce((i,{currency:l,available:r})=>(i[l.toLowerCase()]=r,i),{}):{};return{ace:n(t.ace),ace2:n(t.ace2),bito:a(t.bito)}}}),H=()=>g({queryKey:["getBitfinexWallet"],queryFn:async({signal:t})=>await d(`${p}/cryptoBitfinex/wallet`,{signal:t})}),ee=()=>g({queryKey:["getLendingList"],queryFn:async({signal:t})=>await d(`${p}/cryptoBitfinex/lending/list`,{signal:t})}),te=()=>v({mutationKey:["lending"],mutationFn:async t=>await d({method:"post",url:`${p}/cryptoBitfinex/lending`,data:t})?(D.success("放貸成功"),!0):!1,scope:{id:"lending"}}),se=()=>v({mutationKey:["cancelLending"],mutationFn:async t=>await d({method:"delete",url:`${p}/cryptoBitfinex/lending?id=${t}`})?(D.success("放貸成功"),!0):!1,scope:{id:"cancelLending"}}),ne=t=>g({queryKey:["getBitfinexBook"],queryFn:async({signal:n})=>{const a=await d(`${E}/book/${t}/P0?len=25`,{signal:n,fetchOptions:{originRes:!0}});return a!=null&&a.data?a.data.map(s=>({rate:s[0],yearRate:new $(s[0]).mul(100).mul(365).mul(.85).toNumber(),period:s[1],amount:s[3]})):null},refetchInterval:1e4,enabled:!1}),ae=t=>g({queryKey:["getBitfinexHistory"],queryFn:async({signal:n})=>{const a=await d(`${E}/trades/${t}/hist`,{signal:n,fetchOptions:{originRes:!0}});return a!=null&&a.data?a.data.map(s=>({tradeTime:s[1],rate:s[3],yearRate:new $(s[3]).mul(100).mul(365).mul(.85).toNumber(),period:s[4],amount:s[2]})):null},refetchInterval:1e4,enabled:!1}),re=({colHead:t,rowHead:n,className:a,data:s,isLoading:i,revert:l})=>{const r=m.memo(({rowKey:u,colKey:o,type:B})=>{var x,h;const f=l?(x=s==null?void 0:s[o])==null?void 0:x[u]:(h=s==null?void 0:s[u])==null?void 0:h[o];return B==="dollar"?e.jsx("div",{children:_(f)}):e.jsx("div",{children:f})});return e.jsxs("table",{className:W(["table w-full table-fixed scroll-mt-14",a]),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-400",children:[e.jsx("th",{}),t==null?void 0:t.map((u,o)=>e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:u.name},o))]})}),e.jsx("tbody",{children:n==null?void 0:n.map(u=>e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:u.name}),t==null?void 0:t.map(o=>e.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:e.jsx(Q,{isLoading:i,children:e.jsx(r,{rowKey:u.key,colKey:o.key,type:o.type})})},o.name))]},u.key))})]})},ie=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],oe=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],ce=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],le=({data:t,apiGetData:n,isLoading:a})=>{const{enqueueSnackbar:s}=q(),i=I(y=>y.accessToken),[l,r]=m.useState("BUY"),[u,o]=m.useState("twd"),B=[{name:"BNB",value:"bnb"}],[f,x]=m.useState("bnb"),[h,w]=m.useState(""),[N,S]=m.useState("0.05"),{mutateAsync:C,isPending:b}=X(),F=async()=>{if(!i){s("請先登入");return}await C({action:l,price:h,amount:N,pair:`${f}_${u}`}),n()},{mutateAsync:L,isPending:A}=z(),k=async(y,T)=>{if(!i){s("請先登入");return}y!=="delete"||A||(await L(t[T].id),n())};return e.jsxs("section",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),e.jsx(O,{radioList:ie,value:l,setValue:r,className:"my-2"}),e.jsx(O,{radioList:oe,value:u,setValue:o,className:"my-2"}),e.jsx(O,{radioList:B,value:f,setValue:x,className:"my-2"}),e.jsxs("div",{className:"flex w-fit items-start",children:[e.jsx(j,{id:"bitoPrice",value:h,setValue:w,placeholder:"價格"}),e.jsx(j,{id:"bitoAmount",value:N,setValue:S,placeholder:"數量"}),e.jsx(U,{isLoading:b,disabled:b,onClick:F,children:"下單"})]}),e.jsx(R,{headList:ce,data:t,lineThrough:y=>(y==null?void 0:y.status)===2,customClick:k,isLoading:a})]})},ue=({getWalletAction:t})=>{const[n,a]=m.useState(new Date),{data:s,isFetching:i,refetch:l}=J(Y(n).valueOf()),r=()=>{l(),t==null||t()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("h2",{className:"page-title mr-4",children:"下單區"}),e.jsx(M,{value:n,setValue:a,placeholder:"請選擇日期",className:"w-32"})]}),e.jsx(le,{data:s==null?void 0:s.bito,isLoading:i,apiGetData:r})]})},me=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],de=[{name:"Bito",key:"bito"}],ye=({setGetWalletAction:t})=>{const{data:n,isLoading:a,refetch:s}=Z();return m.useEffect(()=>{t(()=>s)},[t,s]),e.jsxs("section",{children:[e.jsx("h2",{className:"page-title",children:"錢包"}),e.jsx(re,{colHead:me,rowHead:de,data:n||{},isLoading:a})]})},pe=[{name:"USDT",value:"fUST"},{name:"USD",value:"fUSD"}],fe=[{name:"幣種",key:"symbol"},{name:"金額",key:"available",type:"dollar"}],xe=()=>{const{enqueueSnackbar:t}=q(),n=I(c=>c.accessToken);ae("fUST");const{data:a,isFetching:s,refetch:i}=ee(),{data:l,isFetching:r,refetch:u}=H(),{data:o,isLoading:B}=ne("fUST");o==null||o.filter(c=>c.amount<0),o==null||o.filter(c=>c.amount>0);const{mutateAsync:f,isPending:x}=te(),{mutateAsync:h,isPending:w}=se(),N=[{name:"建立時間",key:"createTime",type:"datetime"},{name:"幣別",key:"symbol"},{name:"金額",key:"amount",type:"dollar"},{name:"日利率",key:"rate"},{name:"年利率",type:"custom",customContent:c=>T(c.rate)},{name:"期間",key:"period",type:"number"},...n?[{name:"操作",type:"operation",clickType:"delete"}]:[]],[S,C]=m.useState("fUST"),[b,F]=m.useState(""),[L,A]=m.useState("0.00039"),[k,y]=m.useState("2"),T=c=>isNaN(Number(c))?"NA":_(new $(Number(c)).mul(100).mul(365).mul(.85).toNumber(),{suffix:"%"}),P=async()=>{if(!n){t("請先登入");return}if(Number(b)<=1e-4){t("利率過低");return}await f({amount:Number(b),symbol:S,rate:Number(L),period:Number(k)}),i(),u()},V=async(c,G)=>{if(!n){t("請先登入");return}c!=="delete"||w||(await h(a[G].id),i(),u())};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"my-4",children:[e.jsx("h2",{className:"page-title",children:"放貸"}),e.jsxs("div",{className:"my-2 flex flex-wrap items-center gap-2",children:[e.jsx(O,{radioList:pe,value:S,setValue:C}),e.jsxs("span",{className:"ml-8 text-xs",children:["換算年利率 ",T(L)]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{id:"bitfinexAmount",value:b,setValue:F,placeholder:"請輸入數量"}),e.jsx(j,{id:"bitfinexRate",value:L,setValue:A,placeholder:"請輸入日利率"}),e.jsx(j,{id:"bitfinexPeriod",value:k,setValue:y,placeholder:"請輸入期間"}),e.jsx(U,{isLoading:x,disabled:x,onClick:P,children:"下單"})]}),e.jsx(R,{headList:N,data:a||[],className:"mt-4",customClick:V,isLoading:s,lineThrough:c=>(c==null?void 0:c.status)==="ACTIVE"}),e.jsx(R,{className:"mt-4",headList:fe,data:l||[],isLoading:r}),!1]})})},he=!1,Fe=()=>{const[t,n]=m.useState(null);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"page-title",children:"加密貨幣"})}),he,e.jsx(ue,{getWalletAction:t}),e.jsx(ye,{setGetWalletAction:n}),e.jsx(xe,{})]})};export{Fe as default};
