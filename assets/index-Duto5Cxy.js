import{u as Y,a as Ne,b as A,r as w,A as U,s as L,d as l,j as e,a7 as Se,a8 as Ve,g as Ie,B as b,c as we}from"./index-B6ltmUFs.js";import{B as Ue}from"./BaseSkeleton-DeTKcFG9.js";import{M as Pe}from"./MutiSkeleton-DN_RaUqs.js";import{F as Ce}from"./PencilSquareIcon-K08dnf8_.js";import{i as Re,a as I,o as Ee}from"./validate-DGtL22NN.js";import{T as De}from"./constant-RaoDFmaB.js";import{B as Be}from"./index-DR4Czd_j.js";import{B as v}from"./index-DEt6d1f3.js";import{B as ke}from"./index-DYjScrqd.js";import{B as Ae}from"./index-CEf_p3wS.js";import"./focus-management-CbatjrCL.js";import"./field-C2iFIxF1.js";const Le=()=>A({mutationKey:["addPortfolio"],mutationFn:async s=>{var o;const i=await w({method:"post",url:`${U}/portfolio`,data:s});return((o=i==null?void 0:i.data)==null?void 0:o.code)===200?(L.success("新增成功"),!0):!1},scope:{id:"addPortfolio"}}),_e=s=>{const i=Y();return Ne({queryKey:["portfolioList",s==null?void 0:s.page,s==null?void 0:s.size],queryFn:async({signal:o,queryKey:t})=>{var r,u;const d=i.getQueryData(t);if(d)return d;const n=new URLSearchParams;Object.entries(s).forEach(([m,a])=>{a!==void 0&&a!==-1&&n.append(m,String(a))});const h=n.toString()?`?${n.toString()}`:"",c=await w(`${U}/portfolio/list${h}`,{signal:o});return(r=c==null?void 0:c.data)!=null&&r.data?(u=c==null?void 0:c.data)==null?void 0:u.data:null},staleTime:1e3*60*60,gcTime:1e3*60*60})},$e=()=>A({mutationKey:["editPortfolio"],mutationFn:async s=>{var o;const i=await w({method:"patch",url:`${U}/portfolio?_id=${s._id}`,data:s});return((o=i==null?void 0:i.data)==null?void 0:o.code)===200?(L.success("編輯成功"),!0):!1},scope:{id:"editPortfolio"}}),qe=()=>A({mutationKey:["deletePortfolio"],mutationFn:async s=>{var o;const i=await w({method:"delete",url:`${U}/portfolio?_id=${s}`});return((o=i==null?void 0:i.data)==null?void 0:o.code)===200?(L.success("刪除成功"),!0):!1},scope:{id:"deletePortfolio"}});function Te(s,{threshold:i=0,root:o=null,rootMargin:t="0%",freezeOnceVisible:d=!1}={}){const[n,h]=l.useState(),c=n==null?void 0:n.isIntersecting,r=c&&d,u=([m])=>{h(m)};return l.useEffect(()=>{const m=s==null?void 0:s.current;if(!!!window.IntersectionObserver||r||!m)return;const g={threshold:i,root:o,rootMargin:t},x=new IntersectionObserver(u,g);return x.observe(m),()=>x.disconnect()},[s,o,t,r,i]),{entry:n,inView:c}}const Oe=({src:s,alt:i})=>{const[o,t]=l.useState(!0),d=()=>{t(!1)};return e.jsx("div",{className:"relative",children:e.jsx(Se,{mode:"wait",children:e.jsxs(Ve.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},children:[e.jsx("img",{src:s,alt:i,className:`${o?"!absolute !opacity-0":""} aspect-video w-full object-cover transition`,loading:"lazy",onLoad:d}),e.jsx(Ue,{className:`${o?"":"!absolute !hidden"} !h-[280px]`})]},String(o))})})},X=({data:s,handleEdit:i})=>{const o=Ie(t=>t.accessToken);return e.jsxs("article",{className:"relative h-full overflow-hidden rounded border border-red-50 bg-red-50 shadow transition hover:shadow-xl",children:[e.jsx(Oe,{src:s.img,alt:s.name}),e.jsx("div",{className:"p-4",children:e.jsxs(Pe,{isLoading:!s.img,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-red-700",children:s.name}),o&&e.jsx(b,{type:"icon",className:"text-blue-700",onClick:i,children:e.jsx(Ce,{className:"size-4"})})]}),e.jsx("div",{className:"whitespace-pre-wrap",children:s.content}),e.jsxs("div",{className:"mt-2 flex gap-4",children:[s.pathDemo&&e.jsx("a",{href:s.pathDemo,className:"text-blue-500 hover:underline",title:"demo",target:"_blank",children:"Demo"}),s.pathCode&&e.jsx("a",{href:s.pathCode,className:"text-blue-500 hover:underline",title:"code",target:"_blank",children:"Code"}),s.url&&e.jsx("a",{href:s.url,className:"text-blue-500 hover:underline",title:"article",target:"_blank",children:"Article"})]})]})})]})},Me=[{name:"是",value:"true"},{name:"否",value:"false"}],Fe=({isOpen:s,close:i,type:o,data:t,apiGetData:d})=>{const{enqueueSnackbar:n}=we(),h=Y(),c=l.useRef(null),[r,u]=l.useState(""),[m,a]=l.useState(!1),g=[{validate:Re,message:"請輸入作品名稱"}],[x,j]=l.useState(""),f=l.useRef(null),[p,P]=l.useState(""),[ee,se]=l.useState(!1),te=[{validate:I,message:"請輸入圖片連結"}],_=l.useRef(null),[$,C]=l.useState(""),[le,oe]=l.useState(!1),ie=[{validate:I,message:"請輸入程式碼連結"}],q=l.useRef(null),[T,R]=l.useState(""),[re,ae]=l.useState(!1),ne=[{validate:I,message:"請輸入Demo連結"}],O=l.useRef(null),[M,E]=l.useState(""),[ce,de]=l.useState(!1),ue=[{validate:I,message:"請輸入文章連結"}],F=l.useRef(null),[K,D]=l.useState(""),[me,fe]=l.useState(!1),he=[{validate:Ee,message:"請輸入排序"}],[z,B]=l.useState("true"),{mutateAsync:xe,isPending:y}=Le(),{mutateAsync:pe,isPending:N}=$e(),ge=async()=>{var Q,G,Z,H,J,W;if(![(Q=c.current)==null?void 0:Q.validateNow(),(G=f.current)==null?void 0:G.validateNow(),(Z=_.current)==null?void 0:Z.validateNow(),(H=q.current)==null?void 0:H.validateNow(),(J=O.current)==null?void 0:J.validateNow(),(W=F.current)==null?void 0:W.validateNow()].every(ye=>ye))return n("請確認紅框處內容");const k={name:r,content:x,img:p,pathCode:$,pathDemo:T,url:M,order:Number(K),recommend:z==="true",status:1};(o==="add"?await xe(k):await pe({...k,_id:t==null?void 0:t._id}))&&(h.removeQueries({queryKey:["portfolioList"],exact:!1}),d(),V())},{mutateAsync:je,isPending:S}=qe(),ve=async()=>{if(!window.confirm(`確定要刪除『${t==null?void 0:t.name}』嗎?`)||!(t!=null&&t._id))return;await je(t==null?void 0:t._id)&&(h.removeQueries({queryKey:["portfolioList"],exact:!1}),d(),V())};l.useEffect(()=>{!t||!s||o==="add"||(u(t.name),j(t.content),P(t.img),C(t.pathCode),R(t.pathDemo),E(t.url),D(String(t.order)),B(String(t.recommend)))},[s,t,o]);const V=()=>{i(),u(""),j(""),P(""),C(""),R(""),E(""),D(""),B("true")};return e.jsx(Be,{isOpen:s,close:V,children:e.jsxs("form",{className:"flex max-h-[80dvh] flex-col",children:[e.jsx("div",{className:"mb-4 h-auto text-center text-2xl font-bold text-blue-800",children:`${De[o]||""}作品`}),e.jsxs("section",{className:"overflow-auto",children:[e.jsx(v,{ref:c,id:"life-name",label:"作品名稱",value:r,setValue:u,isValid:m,setIsValid:a,rules:g,placeholder:"請輸入作品名稱"}),e.jsx(ke,{id:"life-content",label:"描述",value:x,setValue:j,placeholder:"請輸入描述"}),e.jsx(v,{className:"mt-5",ref:f,id:"life-imgUrl",label:"圖片網址",value:p,setValue:P,isValid:ee,setIsValid:se,rules:te,placeholder:"請輸入圖片網址"}),e.jsx(v,{ref:_,id:"life-codeUrl",label:"程式碼網址",value:$,setValue:C,isValid:le,setIsValid:oe,rules:ie,placeholder:"請輸入程式碼網址"}),e.jsx(v,{ref:q,id:"life-demoUrl",label:"Demo網址",value:T,setValue:R,isValid:re,setIsValid:ae,rules:ne,placeholder:"請輸入Demo網址"}),e.jsx(v,{ref:O,id:"life-articleUrl",label:"文章網址",value:M,setValue:E,isValid:ce,setIsValid:de,rules:ue,placeholder:"請輸入文章網址"}),e.jsx(v,{ref:F,id:"life-order",label:"排序",value:K,setValue:D,isValid:me,setIsValid:fe,rules:he,placeholder:"請輸入排序"}),e.jsx("label",{className:"base-label",children:"是否推薦"}),e.jsx(Ae,{radioList:Me,value:z,setValue:B})]}),e.jsxs("div",{className:"mt-8 flex h-auto justify-evenly",children:[e.jsx(b,{isLoading:y||N||S,disabled:y||N||S,onClick:ge,children:"送出"}),o==="edit"&&e.jsx(b,{type:"danger",isLoading:y||N||S,disabled:y||N||S,onClick:ve,children:"刪除"}),e.jsx(b,{type:"info",onClick:V,children:"取消"})]})]})})},ls=()=>{const[s,i]=l.useState(""),[o,t]=l.useState(null),d=(f,p)=>{i(f),t(a?a==null?void 0:a[p]:null)},[n,h]=l.useState(1),c=9,{data:r,refetch:u}=_e({page:n-1,size:c}),m=()=>{g([]),h(1),u()},[a,g]=l.useState([]);l.useEffect(()=>{r!=null&&r.list&&g(f=>[...f,...r.list])},[r]);const x=l.useRef(null),{inView:j}=Te(x);return l.useEffect(()=>{j&&Number(r==null?void 0:r.totalPage)>n&&h(f=>f+1)},[j]),e.jsxs("main",{className:"p-4 pb-16",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"page-title",children:"作品集"}),e.jsx(b,{onClick:()=>i("add"),children:"新增"})]}),e.jsxs("section",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[a==null?void 0:a.map((f,p)=>e.jsx(X,{data:f,handleEdit:()=>d("edit",p)},p)),e.jsx("div",{ref:x,children:a.length!==(r==null?void 0:r.totalCount)&&e.jsx(X,{data:{},handleEdit:()=>d("edit",0)})})]}),e.jsx(Fe,{isOpen:s==="add"||s==="edit",close:()=>i(""),type:s,data:o,apiGetData:m})]})};export{ls as default};
