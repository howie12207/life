import{a as L,b as S,r as x,A as h,s as N,g as A,d as m,j as e,t as F,c as R,e as _,B as $}from"./index-BsT9PFH1.js";import{f as I,t as U}from"./format-Btenk6eh.js";import{B as q}from"./index-DBc3Usas.js";import{B as j}from"./index-C_qIEhzP.js";import{B as O}from"./index-D8YX5iPM.js";import{B as P}from"./index-Bw_07ed7.js";import{S as V}from"./index-D4EKTaub.js";import"./floating-ui.react-dom-Bu5kYqTR.js";import"./bugs-_ZnruFTO.js";import"./field-BTel7PYk.js";import"./focus-management-Bxz331r8.js";import"./label-Dle3GftA.js";import"./PencilSquareIcon-BHWd3W6i.js";import"./BaseSkeleton-DQlQ6vKD.js";const Y=()=>S({mutationKey:["bitoOrder"],mutationFn:async s=>{var n;const t=await x({method:"post",url:`${h}/cryptoBito`,data:s});return((n=t==null?void 0:t.data)==null?void 0:n.code)===200?(N.success("下單成功"),!0):!1},scope:{id:"bitoOrder"}}),G=()=>S({mutationKey:["bitoCancelOrder"],mutationFn:async s=>{var n;const t=await x({method:"delete",url:`${h}/cryptoBito?orderId=${s}`});return((n=t==null?void 0:t.data)==null?void 0:n.code)===200?(await A(1e3),N.success("取消成功"),!0):!1},scope:{id:"bitoCancelOrder"}}),K=s=>L({queryKey:["getOrderList",s],queryFn:async({signal:t})=>{const a=(await x(`${h}/cryptoAll/orderList?startTime=${s}`,{signal:t})).data.data;return a?Object.fromEntries(Object.entries(a).map(([c,o])=>[c,o.map(r=>({...r,orderTimeStamp:r.orderTimeStamp||r.tradeTimestamp||r.updatedTimestamp,buyOrSell:r.buyOrSell==="2"||r.action==="SELL"?"賣":r.buyOrSell==="1"||r.action==="BUY"?"買":""}))])):null}}),W=()=>L({queryKey:["getBalanceList"],queryFn:async({signal:s})=>{var n,a;const t=await x(`${h}/cryptoAll/balance`,{signal:s});return(n=t==null?void 0:t.data)!=null&&n.data?(a=t==null?void 0:t.data)==null?void 0:a.data:null},select(s){const t=a=>a.reduce((i,{currencyName:c,cashAmount:o})=>(i[c.toLowerCase()]=o,i),{}),n=a=>a.reduce((i,{currency:c,available:o})=>(i[c.toLowerCase()]=o,i),{});return{ace:t(s.ace),ace2:t(s.ace2),bito:n(s.bito)}}}),M=({colHead:s,rowHead:t,className:n,data:a,isLoading:i,revert:c})=>{const o=m.memo(({rowKey:r,colKey:l,type:b})=>{var y,p;const d=c?(y=a==null?void 0:a[l])==null?void 0:y[r]:(p=a==null?void 0:a[r])==null?void 0:p[l];return b==="dollar"?e.jsx("div",{children:I(d)}):e.jsx("div",{children:d})});return e.jsxs("table",{className:F(["table w-full table-fixed scroll-mt-14",n]),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-400",children:[e.jsx("th",{}),s==null?void 0:s.map((r,l)=>e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name},l))]})}),e.jsx("tbody",{children:t==null?void 0:t.map(r=>e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name}),s==null?void 0:s.map(l=>e.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:e.jsx(V,{isLoading:i,children:e.jsx(o,{rowKey:r.key,colKey:l.key,type:l.type})})},l.name))]},r.key))})]})},Q=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],z=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],J=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],X=({data:s,apiGetData:t,isLoading:n})=>{const{enqueueSnackbar:a}=R(),i=_(u=>u.accessToken),[c,o]=m.useState("BUY"),[r,l]=m.useState("twd"),b=[{name:"BNB",value:"bnb"}],[d,y]=m.useState("bnb"),[p,v]=m.useState(""),[f,D]=m.useState("0.05"),{mutateAsync:T,isPending:B}=Y(),k=async()=>{if(!i){a("請先登入");return}await T({action:c,price:p,amount:f,pair:`${d}_${r}`}),t()},{mutateAsync:C,isPending:g}=G(),w=async(u,E)=>{if(!i){a("請先登入");return}u!=="delete"||g||(await C(s[E].id),t())};return e.jsxs("section",{className:"mb-4",children:[e.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),e.jsx(j,{radioList:Q,value:c,setValue:o,className:"my-2"}),e.jsx(j,{radioList:z,value:r,setValue:l,className:"my-2"}),e.jsx(j,{radioList:b,value:d,setValue:y,className:"my-2"}),e.jsxs("div",{className:"flex w-fit items-start",children:[e.jsx(O,{id:"bitoPrice",value:p,setValue:v,placeholder:"價格"}),e.jsx(O,{id:"bitoAmount",value:f,setValue:D,placeholder:"數量"}),e.jsx($,{isLoading:B,disabled:B,onClick:k,children:"下單"})]}),e.jsx(P,{headList:J,data:s,lineThrough:u=>(u==null?void 0:u.status)===2,customClick:w,isLoading:n})]})},Z=({getWalletAction:s})=>{const[t,n]=m.useState(new Date),{data:a,isFetching:i,refetch:c}=K(U(t).valueOf()),o=()=>{c(),s==null||s()};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"my-4 flex items-center",children:[e.jsx("h2",{className:"page-title mr-4",children:"下單區"}),e.jsx(q,{value:t,setValue:n,placeholder:"請選擇日期",className:"w-32"})]}),e.jsx(X,{data:a==null?void 0:a.bito,isLoading:i,apiGetData:o})]})},H=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],ee=[{name:"Bito",key:"bito"}],te=({setGetWalletAction:s})=>{const{data:t,isLoading:n,refetch:a}=W();return m.useEffect(()=>{s(()=>a)},[s,a]),e.jsxs("section",{children:[e.jsx("h2",{className:"page-title",children:"錢包"}),e.jsx(M,{colHead:H,rowHead:ee,data:t||{},isLoading:n})]})},se=!1,be=()=>{const[s,t]=m.useState(null);return e.jsxs("main",{className:"p-4 pb-16",children:[e.jsx("div",{className:"mb-4 flex items-center justify-between",children:e.jsx("h2",{className:"page-title",children:"加密貨幣"})}),se,e.jsx(Z,{getWalletAction:s}),e.jsx(te,{setGetWalletAction:t})]})};export{be as default};
