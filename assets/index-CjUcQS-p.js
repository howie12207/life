import{d as g,e as O,r as m,A as p,s as D,i as K,k as E,D as R,g as d,j as t,t as W,f as q,u as I,B as U}from"./index-DDypmYjo.js";import{f as _,t as Y}from"./index-CkZiW-Ay.js";import{B as M}from"./index-C2aQDjq0.js";import{B as v}from"./index-5NYMG7co.js";import{B as j}from"./index-Dz8zM4Uw.js";import{B as $}from"./index-DVgk-sXN.js";import{S as Q}from"./index-BX-gnj5d.js";import"./floating-ui.react-dom-CVX-LADh.js";import"./bugs-B2fo5EXd.js";import"./field-Bfwf_xNg.js";import"./focus-management-Df9FbtWO.js";import"./label-B4nrvT7a.js";import"./PencilSquareIcon-C5fPVU_r.js";import"./BaseSkeleton-DJrillBd.js";const X=()=>O({mutationKey:["bitoOrder"],mutationFn:async a=>{var s;const e=await m({method:"post",url:`${p}/cryptoBito`,data:a});return((s=e==null?void 0:e.data)==null?void 0:s.code)===200?(D.success("下單成功"),!0):!1},scope:{id:"bitoOrder"}}),z=()=>O({mutationKey:["bitoCancelOrder"],mutationFn:async a=>{var s;const e=await m({method:"delete",url:`${p}/cryptoBito?orderId=${a}`});return((s=e==null?void 0:e.data)==null?void 0:s.code)===200?(await K(1e3),D.success("取消成功"),!0):!1},scope:{id:"bitoCancelOrder"}}),J=a=>g({queryKey:["getOrderList",a],queryFn:async({signal:e})=>{const n=(await m(`${p}/cryptoAll/orderList?startTime=${a}`,{signal:e})).data.data;return n?Object.fromEntries(Object.entries(n).map(([c,u])=>[c,u.map(r=>({...r,orderTimeStamp:r.orderTimeStamp||r.tradeTimestamp||r.updatedTimestamp,buyOrSell:r.buyOrSell==="2"||r.action==="SELL"?"賣":r.buyOrSell==="1"||r.action==="BUY"?"買":""}))])):null}}),Z=()=>g({queryKey:["getBalanceList"],queryFn:async({signal:a})=>{var s,n;const e=await m(`${p}/cryptoAll/balance`,{signal:a});return(s=e==null?void 0:e.data)!=null&&s.data?(n=e==null?void 0:e.data)==null?void 0:n.data:null},select(a){const e=n=>n?n.reduce((l,{currencyName:c,cashAmount:u})=>(l[c.toLowerCase()]=u,l),{}):{},s=n=>n?n.reduce((l,{currency:c,available:u})=>(l[c.toLowerCase()]=u,l),{}):{};return{ace:e(a.ace),ace2:e(a.ace2),bito:s(a.bito)}}}),H=()=>g({queryKey:["getBitfinexWallet"],queryFn:async({signal:a})=>{var s;const e=await m(`${p}/cryptoBitfinex/wallet`,{signal:a});return(s=e==null?void 0:e.data)!=null&&s.data?e.data.data:null}}),ee=()=>g({queryKey:["getLendingList"],queryFn:async({signal:a})=>{var s;const e=await m(`${p}/cryptoBitfinex/lending/list`,{signal:a});return(s=e==null?void 0:e.data)!=null&&s.data?e.data.data:null}}),te=()=>O({mutationKey:["lending"],mutationFn:async a=>{var s;const e=await m({method:"post",url:`${p}/cryptoBitfinex/lending`,data:a});return((s=e==null?void 0:e.data)==null?void 0:s.code)===200?(D.success("放貸成功"),!0):!1},scope:{id:"lending"}}),ae=()=>O({mutationKey:["cancelLending"],mutationFn:async a=>{var s;const e=await m({method:"delete",url:`${p}/cryptoBitfinex/lending?id=${a}`});return((s=e==null?void 0:e.data)==null?void 0:s.code)===200?(D.success("放貸成功"),!0):!1},scope:{id:"cancelLending"}}),se=a=>g({queryKey:["getBitfinexBook"],queryFn:async({signal:e})=>{const s=await m(`${E}/book/${a}/P0?len=25`,{signal:e});return s!=null&&s.data?s.data.map(n=>({rate:n[0],yearRate:new R(n[0]).mul(100).mul(365).mul(.85).toNumber(),period:n[1],amount:n[3]})):null},refetchInterval:1e4,enabled:!1}),ne=a=>g({queryKey:["getBitfinexHistory"],queryFn:async({signal:e})=>{const s=await m(`${E}/trades/${a}/hist`,{signal:e});return s!=null&&s.data?s.data.map(n=>({tradeTime:n[1],rate:n[3],yearRate:new R(n[3]).mul(100).mul(365).mul(.85).toNumber(),period:n[4],amount:n[2]})):null},refetchInterval:1e4,enabled:!1}),re=({colHead:a,rowHead:e,className:s,data:n,isLoading:l,revert:c})=>{const u=d.memo(({rowKey:r,colKey:i,type:B})=>{var x,h;const f=c?(x=n==null?void 0:n[i])==null?void 0:x[r]:(h=n==null?void 0:n[r])==null?void 0:h[i];return B==="dollar"?t.jsx("div",{children:_(f)}):t.jsx("div",{children:f})});return t.jsxs("table",{className:W(["table w-full table-fixed scroll-mt-14",s]),children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b-2 border-gray-400",children:[t.jsx("th",{}),a==null?void 0:a.map((r,i)=>t.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name},i))]})}),t.jsx("tbody",{children:e==null?void 0:e.map(r=>t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name}),a==null?void 0:a.map(i=>t.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:t.jsx(Q,{isLoading:l,children:t.jsx(u,{rowKey:r.key,colKey:i.key,type:i.type})})},i.name))]},r.key))})]})},ie=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],le=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],oe=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],ce=({data:a,apiGetData:e,isLoading:s})=>{const{enqueueSnackbar:n}=q(),l=I(y=>y.accessToken),[c,u]=d.useState("BUY"),[r,i]=d.useState("twd"),B=[{name:"BNB",value:"bnb"}],[f,x]=d.useState("bnb"),[h,w]=d.useState(""),[N,S]=d.useState("0.05"),{mutateAsync:C,isPending:b}=X(),F=async()=>{if(!l){n("請先登入");return}await C({action:c,price:h,amount:N,pair:`${f}_${r}`}),e()},{mutateAsync:L,isPending:A}=z(),k=async(y,T)=>{if(!l){n("請先登入");return}y!=="delete"||A||(await L(a[T].id),e())};return t.jsxs("section",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),t.jsx(v,{radioList:ie,value:c,setValue:u,className:"my-2"}),t.jsx(v,{radioList:le,value:r,setValue:i,className:"my-2"}),t.jsx(v,{radioList:B,value:f,setValue:x,className:"my-2"}),t.jsxs("div",{className:"flex w-fit items-start",children:[t.jsx(j,{id:"bitoPrice",value:h,setValue:w,placeholder:"價格"}),t.jsx(j,{id:"bitoAmount",value:N,setValue:S,placeholder:"數量"}),t.jsx(U,{isLoading:b,disabled:b,onClick:F,children:"下單"})]}),t.jsx($,{headList:oe,data:a,lineThrough:y=>(y==null?void 0:y.status)===2,customClick:k,isLoading:s})]})},ue=({getWalletAction:a})=>{const[e,s]=d.useState(new Date),{data:n,isFetching:l,refetch:c}=J(Y(e).valueOf()),u=()=>{c(),a==null||a()};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"my-4 flex items-center",children:[t.jsx("h2",{className:"page-title mr-4",children:"下單區"}),t.jsx(M,{value:e,setValue:s,placeholder:"請選擇日期",className:"w-32"})]}),t.jsx(ce,{data:n==null?void 0:n.bito,isLoading:l,apiGetData:u})]})},de=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],me=[{name:"Bito",key:"bito"}],ye=({setGetWalletAction:a})=>{const{data:e,isLoading:s,refetch:n}=Z();return d.useEffect(()=>{a(()=>n)},[a,n]),t.jsxs("section",{children:[t.jsx("h2",{className:"page-title",children:"錢包"}),t.jsx(re,{colHead:de,rowHead:me,data:e||{},isLoading:s})]})},pe=[{name:"USDT",value:"fUST"},{name:"USD",value:"fUSD"}],fe=[{name:"幣種",key:"symbol"},{name:"金額",key:"available",type:"dollar"}],xe=()=>{const{enqueueSnackbar:a}=q(),e=I(o=>o.accessToken);ne("fUST");const{data:s,isFetching:n,refetch:l}=ee(),{data:c,isFetching:u,refetch:r}=H(),{data:i,isLoading:B}=se("fUST");i==null||i.filter(o=>o.amount<0),i==null||i.filter(o=>o.amount>0);const{mutateAsync:f,isPending:x}=te(),{mutateAsync:h,isPending:w}=ae(),N=[{name:"建立時間",key:"createTime",type:"datetime"},{name:"幣別",key:"symbol"},{name:"金額",key:"amount",type:"dollar"},{name:"日利率",key:"rate"},{name:"年利率",type:"custom",customContent:o=>T(o.rate)},{name:"期間",key:"period",type:"number"},...e?[{name:"操作",type:"operation",clickType:"delete"}]:[]],[S,C]=d.useState("fUST"),[b,F]=d.useState(""),[L,A]=d.useState("0.00039"),[k,y]=d.useState("2"),T=o=>isNaN(Number(o))?"NA":_(new R(Number(o)).mul(100).mul(365).mul(.85).toNumber(),{suffix:"%"}),P=async()=>{if(!e){a("請先登入");return}if(Number(b)<=1e-4){a("利率過低");return}await f({amount:Number(b),symbol:S,rate:Number(L),period:Number(k)}),l(),r()},V=async(o,G)=>{if(!e){a("請先登入");return}o!=="delete"||w||(await h(s[G].id),l(),r())};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"my-4",children:[t.jsx("h2",{className:"page-title",children:"放貸"}),t.jsxs("div",{className:"my-2 flex flex-wrap items-center gap-2",children:[t.jsx(v,{radioList:pe,value:S,setValue:C}),t.jsxs("span",{className:"ml-8 text-xs",children:["換算年利率 ",T(L)]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(j,{id:"bitfinexAmount",value:b,setValue:F,placeholder:"請輸入數量"}),t.jsx(j,{id:"bitfinexRate",value:L,setValue:A,placeholder:"請輸入日利率"}),t.jsx(j,{id:"bitfinexPeriod",value:k,setValue:y,placeholder:"請輸入期間"}),t.jsx(U,{isLoading:x,disabled:x,onClick:P,children:"下單"})]}),t.jsx($,{headList:N,data:s||[],className:"mt-4",customClick:V,isLoading:n,lineThrough:o=>(o==null?void 0:o.status)==="ACTIVE"}),t.jsx($,{className:"mt-4",headList:fe,data:c||[],isLoading:u}),!1]})})},he=!1,Fe=()=>{const[a,e]=d.useState(null);return t.jsxs("main",{className:"p-4 pb-16",children:[t.jsx("div",{className:"mb-4 flex items-center justify-between",children:t.jsx("h2",{className:"page-title",children:"加密貨幣"})}),he,t.jsx(ue,{getWalletAction:a}),t.jsx(ye,{setGetWalletAction:e}),t.jsx(xe,{})]})};export{Fe as default};
