import{d as j,e as O,r as y,A as p,s as D,i as G,k as K,D as R,g as d,j as t,t as W,f as $,u as I,B as _}from"./index-ZmCP8L0s.js";import{f as q,t as Y}from"./format-DFDMiaYQ.js";import{B as M}from"./index-ByKGIZES.js";import{B as v}from"./index-4ebJzymB.js";import{B as L}from"./index-D6RcT6RW.js";import{B as E}from"./index-CN5CQx-f.js";import{S as Q}from"./index-BJUMnAG1.js";import"./floating-ui.react-dom-bU_g7fo8.js";import"./bugs-CmSmUzuL.js";import"./field-B_LeM9YR.js";import"./focus-management-DyVfTjYv.js";import"./label-Ay3-mu1q.js";import"./PencilSquareIcon-dEtK1Uz7.js";import"./BaseSkeleton-DteRWsUG.js";const X=()=>O({mutationKey:["bitoOrder"],mutationFn:async s=>{var a;const e=await y({method:"post",url:`${p}/cryptoBito`,data:s});return((a=e==null?void 0:e.data)==null?void 0:a.code)===200?(D.success("下單成功"),!0):!1},scope:{id:"bitoOrder"}}),z=()=>O({mutationKey:["bitoCancelOrder"],mutationFn:async s=>{var a;const e=await y({method:"delete",url:`${p}/cryptoBito?orderId=${s}`});return((a=e==null?void 0:e.data)==null?void 0:a.code)===200?(await G(1e3),D.success("取消成功"),!0):!1},scope:{id:"bitoCancelOrder"}}),J=s=>j({queryKey:["getOrderList",s],queryFn:async({signal:e})=>{const n=(await y(`${p}/cryptoAll/orderList?startTime=${s}`,{signal:e})).data.data;return n?Object.fromEntries(Object.entries(n).map(([o,u])=>[o,u.map(r=>({...r,orderTimeStamp:r.orderTimeStamp||r.tradeTimestamp||r.updatedTimestamp,buyOrSell:r.buyOrSell==="2"||r.action==="SELL"?"賣":r.buyOrSell==="1"||r.action==="BUY"?"買":""}))])):null}}),Z=()=>j({queryKey:["getBalanceList"],queryFn:async({signal:s})=>{var a,n;const e=await y(`${p}/cryptoAll/balance`,{signal:s});return(a=e==null?void 0:e.data)!=null&&a.data?(n=e==null?void 0:e.data)==null?void 0:n.data:null},select(s){const e=n=>n?n.reduce((c,{currencyName:o,cashAmount:u})=>(c[o.toLowerCase()]=u,c),{}):{},a=n=>n?n.reduce((c,{currency:o,available:u})=>(c[o.toLowerCase()]=u,c),{}):{};return{ace:e(s.ace),ace2:e(s.ace2),bito:a(s.bito)}}}),H=()=>j({queryKey:["getBitfinexWallet"],queryFn:async({signal:s})=>{var a;const e=await y(`${p}/cryptoBitfinex/wallet`,{signal:s});return(a=e==null?void 0:e.data)!=null&&a.data?e.data.data:null}}),ee=()=>j({queryKey:["getLendingList"],queryFn:async({signal:s})=>{var a;const e=await y(`${p}/cryptoBitfinex/lending/list`,{signal:s});return(a=e==null?void 0:e.data)!=null&&a.data?e.data.data:null}}),te=()=>O({mutationKey:["lending"],mutationFn:async s=>{var a;const e=await y({method:"post",url:`${p}/cryptoBitfinex/lending`,data:s});return((a=e==null?void 0:e.data)==null?void 0:a.code)===200?(D.success("放貸成功"),!0):!1},scope:{id:"lending"}}),se=()=>O({mutationKey:["cancelLending"],mutationFn:async s=>{var a;const e=await y({method:"delete",url:`${p}/cryptoBitfinex/lending?id=${s}`});return((a=e==null?void 0:e.data)==null?void 0:a.code)===200?(D.success("放貸成功"),!0):!1},scope:{id:"cancelLending"}}),ae=s=>j({queryKey:["getBitfinexBook"],queryFn:async({signal:e})=>{const a=await y(`${K}/book/${s}/P0?len=25`,{signal:e});return a!=null&&a.data?a.data.map(n=>({rate:n[0],yearRate:new R(n[0]).mul(100).mul(365).mul(.85).toNumber(),period:n[1],amount:n[3]})):null},refetchInterval:1e4,enabled:!1}),ne=({colHead:s,rowHead:e,className:a,data:n,isLoading:c,revert:o})=>{const u=d.memo(({rowKey:r,colKey:i,type:B})=>{var x,h;const f=o?(x=n==null?void 0:n[i])==null?void 0:x[r]:(h=n==null?void 0:n[r])==null?void 0:h[i];return B==="dollar"?t.jsx("div",{children:q(f)}):t.jsx("div",{children:f})});return t.jsxs("table",{className:W(["table w-full table-fixed scroll-mt-14",a]),children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b-2 border-gray-400",children:[t.jsx("th",{}),s==null?void 0:s.map((r,i)=>t.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name},i))]})}),t.jsx("tbody",{children:e==null?void 0:e.map(r=>t.jsxs("tr",{children:[t.jsx("th",{className:"p-2 text-left text-sm sm:p-4",children:r.name}),s==null?void 0:s.map(i=>t.jsx("td",{className:"p-2 text-left text-sm sm:p-4",children:t.jsx(Q,{isLoading:c,children:t.jsx(u,{rowKey:r.key,colKey:i.key,type:i.type})})},i.name))]},r.key))})]})},re=[{name:"買",value:"BUY"},{name:"賣",value:"SELL"}],ie=[{name:"TWD",value:"twd"},{name:"USDT",value:"usdt"}],ce=[{name:"時間",key:"orderTimeStamp",type:"datetime"},{name:"價格",key:"price",type:"dollar"},{name:"買/賣",key:"buyOrSell"},{name:"操作",type:"operation",clickType:"delete"}],le=({data:s,apiGetData:e,isLoading:a})=>{const{enqueueSnackbar:n}=$(),c=I(m=>m.accessToken),[o,u]=d.useState("BUY"),[r,i]=d.useState("twd"),B=[{name:"BNB",value:"bnb"}],[f,x]=d.useState("bnb"),[h,w]=d.useState(""),[N,S]=d.useState("0.05"),{mutateAsync:C,isPending:b}=X(),F=async()=>{if(!c){n("請先登入");return}await C({action:o,price:h,amount:N,pair:`${f}_${r}`}),e()},{mutateAsync:g,isPending:A}=z(),k=async(m,T)=>{if(!c){n("請先登入");return}m!=="delete"||A||(await g(s[T].id),e())};return t.jsxs("section",{className:"mb-4",children:[t.jsx("h3",{className:"text-lg font-bold",children:"Bito"}),t.jsx(v,{radioList:re,value:o,setValue:u,className:"my-2"}),t.jsx(v,{radioList:ie,value:r,setValue:i,className:"my-2"}),t.jsx(v,{radioList:B,value:f,setValue:x,className:"my-2"}),t.jsxs("div",{className:"flex w-fit items-start",children:[t.jsx(L,{id:"bitoPrice",value:h,setValue:w,placeholder:"價格"}),t.jsx(L,{id:"bitoAmount",value:N,setValue:S,placeholder:"數量"}),t.jsx(_,{isLoading:b,disabled:b,onClick:F,children:"下單"})]}),t.jsx(E,{headList:ce,data:s,lineThrough:m=>(m==null?void 0:m.status)===2,customClick:k,isLoading:a})]})},oe=({getWalletAction:s})=>{const[e,a]=d.useState(new Date),{data:n,isFetching:c,refetch:o}=J(Y(e).valueOf()),u=()=>{o(),s==null||s()};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"my-4 flex items-center",children:[t.jsx("h2",{className:"page-title mr-4",children:"下單區"}),t.jsx(M,{value:e,setValue:a,placeholder:"請選擇日期",className:"w-32"})]}),t.jsx(le,{data:n==null?void 0:n.bito,isLoading:c,apiGetData:u})]})},ue=[{name:"BNB",key:"bnb",type:"dollar"},{name:"TWD",key:"twd",type:"dollar"}],de=[{name:"Bito",key:"bito"}],me=({setGetWalletAction:s})=>{const{data:e,isLoading:a,refetch:n}=Z();return d.useEffect(()=>{s(()=>n)},[s,n]),t.jsxs("section",{children:[t.jsx("h2",{className:"page-title",children:"錢包"}),t.jsx(ne,{colHead:ue,rowHead:de,data:e||{},isLoading:a})]})},ye=[{name:"USDT",value:"fUST"},{name:"USD",value:"fUSD"}],pe=[{name:"幣種",key:"symbol"},{name:"金額",key:"available",type:"dollar"}],fe=()=>{const{enqueueSnackbar:s}=$(),e=I(l=>l.accessToken),{data:a,isFetching:n,refetch:c}=ee(),{data:o,isFetching:u,refetch:r}=H(),{data:i,isFetching:B}=ae("fUST");i==null||i.filter(l=>l.amount<0),i==null||i.filter(l=>l.amount>0);const{mutateAsync:f,isPending:x}=te(),{mutateAsync:h,isPending:w}=se(),N=[{name:"建立時間",key:"createTime",type:"datetime"},{name:"幣別",key:"symbol"},{name:"金額",key:"amount",type:"dollar"},{name:"日利率",key:"rate"},{name:"年利率",type:"custom",customContent:l=>T(l.rate)},{name:"期間",key:"period",type:"number"},...e?[{name:"操作",type:"operation",clickType:"delete"}]:[]],[S,C]=d.useState("fUST"),[b,F]=d.useState(""),[g,A]=d.useState("0.00039"),[k,m]=d.useState("2"),T=l=>isNaN(Number(l))?"NA":q(new R(Number(l)).mul(100).mul(365).mul(.85).toNumber(),{suffix:"%"}),U=async()=>{if(!e){s("請先登入");return}if(Number(b)<=1e-4){s("利率過低");return}await f({amount:Number(b),symbol:S,rate:Number(g),period:Number(k)}),c(),r()},P=async(l,V)=>{if(!e){s("請先登入");return}l!=="delete"||w||(await h(a[V].id),c(),r())};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"my-4",children:[t.jsx("h2",{className:"page-title",children:"放貸"}),t.jsxs("div",{className:"my-2 flex flex-wrap items-center gap-2",children:[t.jsx(v,{radioList:ye,value:S,setValue:C}),t.jsxs("span",{className:"ml-8 text-xs",children:["換算年利率 ",T(g)]})]}),t.jsxs("div",{className:"flex gap-1",children:[t.jsx(L,{id:"bitfinexAmount",value:b,setValue:F,placeholder:"請輸入數量"}),t.jsx(L,{id:"bitfinexRate",value:g,setValue:A,placeholder:"請輸入日利率"}),t.jsx(L,{id:"bitfinexPeriod",value:k,setValue:m,placeholder:"請輸入期間"}),t.jsx(_,{isLoading:x,disabled:x,onClick:U,children:"下單"})]}),t.jsx(E,{headList:N,data:a||[],className:"mt-4",customClick:P,isLoading:n,lineThrough:l=>(l==null?void 0:l.status)==="ACTIVE"}),t.jsx(E,{className:"mt-4",headList:pe,data:o||[],isLoading:u}),!1]})})},xe=!1,Ce=()=>{const[s,e]=d.useState(null);return t.jsxs("main",{className:"p-4 pb-16",children:[t.jsx("div",{className:"mb-4 flex items-center justify-between",children:t.jsx("h2",{className:"page-title",children:"加密貨幣"})}),xe,t.jsx(oe,{getWalletAction:s}),t.jsx(me,{setGetWalletAction:e}),t.jsx(fe,{})]})};export{Ce as default};
